<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Iván Arribas (Depto. Análisis Económico. Universitat de València)">

<title>Predicción con Datos Temporales - Técnicas de Alisado Exponencial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Predicción con Datos Temporales</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01-Guia-curso.html" rel="" target="">
 <span class="menu-text">Guía del curso</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02-Logistica.html" rel="" target="">
 <span class="menu-text">Logística</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-diapos" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Diapos</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-diapos">    
        <li class="dropdown-header">Teoría</li>
        <li>
    <a class="dropdown-item" href="./03-01-Tema1.html" rel="" target="">
 <span class="dropdown-text">Tema 1: Introducción</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-02-Tema2.html" rel="" target="">
 <span class="dropdown-text">Tema 2: Definición</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-03-Tema3.html" rel="" target="">
 <span class="dropdown-text">Tema 3: Métodos sencillos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-04-Tema4.html" rel="" target="">
 <span class="dropdown-text">Tema 4: Media móvil</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-05-Tema5.html" rel="" target="">
 <span class="dropdown-text">Tema 5: Alisado</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-06-Tema6.html" rel="" target="">
 <span class="dropdown-text">Tema 6: ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-07-Tema7.html" rel="" target="">
 <span class="dropdown-text">Tema 7: SARIMA</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Ejemplo de aplicación</li>
        <li>
    <a class="dropdown-item" href="./03-08-Ejemplo2.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-09-Ejemplo3.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-10-Ejemplo4.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-11-Ejemplo5.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-12-Ejemplo6.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-13-Ejemplo7.html" rel="" target="">
 <span class="dropdown-text">Ejemplo Tema 7</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otro ejemplo</li>
        <li>
    <a class="dropdown-item" href="./03-14-Ejemplo-Pasajeros.html" rel="" target="">
 <span class="dropdown-text">Ejemplo de Pasajeros</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-píldoras" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Píldoras</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-píldoras">    
        <li>
    <a class="dropdown-item" href="./04-01-Bootstrapping.html" rel="" target="">
 <span class="dropdown-text">Bootstrapping para IC</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-02-Multiples_CS.html" rel="" target="">
 <span class="dropdown-text">Múltiples componentes estacionales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-03-Redes_neuronales.html" rel="" target="">
 <span class="dropdown-text">Predicción con Redes Neuronales</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-04-Series_acotadas.html" rel="" target="">
 <span class="dropdown-text">Series acotadas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-05-Valores_perdidos_Outliers.html" rel="" target="">
 <span class="dropdown-text">Valores perdidos y outliers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-06-Covid_Nacimientos.html" rel="" target="">
 <span class="dropdown-text">Efecto de la Covid-19 en Nacimientos</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./05-Recursos-R.html" rel="" target="">
 <span class="menu-text">Recursos de la asignatura</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./06-Evaluacion_Continua.html" rel="" target="">
 <span class="menu-text">Evaluacion Continua</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-más" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Más</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-más">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="https://cran.r-project.org" rel="" target="">
 <span class="dropdown-text">Dónde está R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rstudio.com" rel="" target="">
 <span class="dropdown-text">Donde está RStudio</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Markdown</li>
        <li>
    <a class="dropdown-item" href="https://bookdown.org/yihui/rmarkdown/" rel="" target="">
 <span class="dropdown-text">Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rmarkdown.rstudio.com/lesson-1.html" rel="" target="">
 <span class="dropdown-text">R Markdown</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf" rel="" target="">
 <span class="dropdown-text">R Markdown (pdf)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://quarto.org/docs/tools/rstudio.html" rel="" target="">
 <span class="dropdown-text">Quatro</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Otros</li>
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com" rel="" target="">
 <span class="dropdown-text">Blog sobre R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://bookdown.org" rel="" target="">
 <span class="dropdown-text">Libros online que debes conocer</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción"><span class="header-section-number">1</span> Introducción</a></li>
  <li><a href="#componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" id="toc-componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" class="nav-link" data-scroll-target="#componentes-de-una-serie-en-el-contexto-del-alisado-exponencial"><span class="header-section-number">2</span> Componentes de una serie en el contexto del alisado exponencial</a></li>
  <li><a href="#casos-posibles" id="toc-casos-posibles" class="nav-link" data-scroll-target="#casos-posibles"><span class="header-section-number">3</span> Casos posibles</a>
  <ul class="collapse">
  <li><a href="#las-funciones-ets-y-forecast" id="toc-las-funciones-ets-y-forecast" class="nav-link" data-scroll-target="#las-funciones-ets-y-forecast"><span class="header-section-number">3.1</span> Las funciones <code>ets</code> y <code>forecast</code></a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-simple-a-n-n" id="toc-alisado-exponencial-simple-a-n-n" class="nav-link" data-scroll-target="#alisado-exponencial-simple-a-n-n"><span class="header-section-number">4</span> Alisado exponencial simple (A, N, N)</a>
  <ul class="collapse">
  <li><a href="#definición" id="toc-definición" class="nav-link" data-scroll-target="#definición"><span class="header-section-number">4.1</span> Definición</a></li>
  <li><a href="#formulas-interactivas-de-sus-componentes" id="toc-formulas-interactivas-de-sus-componentes" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes"><span class="header-section-number">4.2</span> Formulas interactivas de sus componentes</a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo" id="toc-estimación-de-los-parámetros-del-modelo" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo"><span class="header-section-number">4.3</span> Estimación de los parámetros del modelo</a></li>
  <li><a href="#ejemplo" id="toc-ejemplo" class="nav-link" data-scroll-target="#ejemplo"><span class="header-section-number">4.4</span> Ejemplo</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-de-holt-a-a-n" id="toc-alisado-exponencial-de-holt-a-a-n" class="nav-link" data-scroll-target="#alisado-exponencial-de-holt-a-a-n"><span class="header-section-number">5</span> Alisado exponencial de Holt (A, A, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes-1" id="toc-formulas-interactivas-de-sus-componentes-1" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes-1"><span class="header-section-number">5.1</span> Formulas interactivas de sus componentes</a></li>
  <li><a href="#estimación-de-los-parámetros-del-modelo-1" id="toc-estimación-de-los-parámetros-del-modelo-1" class="nav-link" data-scroll-target="#estimación-de-los-parámetros-del-modelo-1"><span class="header-section-number">5.2</span> Estimación de los parámetros del modelo</a></li>
  <li><a href="#ejemplo-1" id="toc-ejemplo-1" class="nav-link" data-scroll-target="#ejemplo-1"><span class="header-section-number">5.3</span> Ejemplo</a></li>
  </ul></li>
  <li><a href="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n" id="toc-alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="nav-link" data-scroll-target="#alisado-exponencial-con-pendiente-amortiguada-a-ad-n"><span class="header-section-number">6</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</a>
  <ul class="collapse">
  <li><a href="#formulas-interactivas-de-sus-componentes-2" id="toc-formulas-interactivas-de-sus-componentes-2" class="nav-link" data-scroll-target="#formulas-interactivas-de-sus-componentes-2"><span class="header-section-number">6.1</span> Formulas interactivas de sus componentes</a></li>
  <li><a href="#ejemplo-2" id="toc-ejemplo-2" class="nav-link" data-scroll-target="#ejemplo-2"><span class="header-section-number">6.2</span> Ejemplo</a></li>
  </ul></li>
  <li><a href="#alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" id="toc-alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" class="nav-link" data-scroll-target="#alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m"><span class="header-section-number">7</span> Alisado de Holt-Winters aditivo (A, A, A) y multiplicativo (M, A, M)</a>
  <ul class="collapse">
  <li><a href="#alisado-de-holt-winters-aditivo-a-a-a" id="toc-alisado-de-holt-winters-aditivo-a-a-a" class="nav-link" data-scroll-target="#alisado-de-holt-winters-aditivo-a-a-a"><span class="header-section-number">7.1</span> Alisado de Holt-Winters aditivo (A, A, A)</a></li>
  <li><a href="#alisado-de-holt-winters-multiplicativo-m-a-m" id="toc-alisado-de-holt-winters-multiplicativo-m-a-m" class="nav-link" data-scroll-target="#alisado-de-holt-winters-multiplicativo-m-a-m"><span class="header-section-number">7.2</span> Alisado de Holt-Winters multiplicativo (M, A, M)</a></li>
  <li><a href="#ejemplo-con-demanda-electrica" id="toc-ejemplo-con-demanda-electrica" class="nav-link" data-scroll-target="#ejemplo-con-demanda-electrica"><span class="header-section-number">7.3</span> Ejemplo con Demanda electrica</a></li>
  <li><a href="#ejemplo-con-nacimientos" id="toc-ejemplo-con-nacimientos" class="nav-link" data-scroll-target="#ejemplo-con-nacimientos"><span class="header-section-number">7.4</span> Ejemplo con Nacimientos</a></li>
  </ul></li>
  <li><a href="#ejemplo-con-transformación-logarítmica" id="toc-ejemplo-con-transformación-logarítmica" class="nav-link" data-scroll-target="#ejemplo-con-transformación-logarítmica"><span class="header-section-number">8</span> Ejemplo con transformación logarítmica</a></li>
  <li><a href="#casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" id="toc-casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" class="nav-link" data-scroll-target="#casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo"><span class="header-section-number">9</span> Casos generales de alisado exponencial: la función <code>ets</code> (de nuevo)</a>
  <ul class="collapse">
  <li><a href="#criterios-de-optimización" id="toc-criterios-de-optimización" class="nav-link" data-scroll-target="#criterios-de-optimización"><span class="header-section-number">9.1</span> Criterios de optimización</a></li>
  <li><a href="#criterios-de-selección-de-modelos" id="toc-criterios-de-selección-de-modelos" class="nav-link" data-scroll-target="#criterios-de-selección-de-modelos"><span class="header-section-number">9.2</span> Criterios de selección de modelos</a></li>
  </ul></li>
  <li><a href="#residuo-de-un-modelo" id="toc-residuo-de-un-modelo" class="nav-link" data-scroll-target="#residuo-de-un-modelo"><span class="header-section-number">10</span> Residuo de un modelo</a></li>
  <li><a href="#ejemplos-de-aplicación" id="toc-ejemplos-de-aplicación" class="nav-link" data-scroll-target="#ejemplos-de-aplicación"><span class="header-section-number">11</span> Ejemplos de aplicación</a>
  <ul class="collapse">
  <li><a href="#libros" id="toc-libros" class="nav-link" data-scroll-target="#libros"><span class="header-section-number">11.1</span> Libros</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo" id="toc-identificación-y-estimación-del-mejor-modelo" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción" id="toc-predicción" class="nav-link" data-scroll-target="#predicción">Predicción</a></li>
  <li><a href="#análisis-del-residuo" id="toc-análisis-del-residuo" class="nav-link" data-scroll-target="#análisis-del-residuo">Análisis del residuo</a></li>
  <li><a href="#validación-error-extramuestral-a-varios-periodos-vista" id="toc-validación-error-extramuestral-a-varios-periodos-vista" class="nav-link" data-scroll-target="#validación-error-extramuestral-a-varios-periodos-vista">Validación: error extramuestral a varios periodos vista</a></li>
  </ul></li>
  <li><a href="#nacimientos" id="toc-nacimientos" class="nav-link" data-scroll-target="#nacimientos"><span class="header-section-number">11.2</span> Nacimientos</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo-1" id="toc-identificación-y-estimación-del-mejor-modelo-1" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo-1">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción-1" id="toc-predicción-1" class="nav-link" data-scroll-target="#predicción-1">Predicción</a></li>
  <li><a href="#análisis-del-error" id="toc-análisis-del-error" class="nav-link" data-scroll-target="#análisis-del-error">Análisis del error</a></li>
  <li><a href="#validación-error-extramuestral-según-horizonte-temporal" id="toc-validación-error-extramuestral-según-horizonte-temporal" class="nav-link" data-scroll-target="#validación-error-extramuestral-según-horizonte-temporal">Validación: error extramuestral según horizonte temporal</a></li>
  </ul></li>
  <li><a href="#demanda-eléctrica" id="toc-demanda-eléctrica" class="nav-link" data-scroll-target="#demanda-eléctrica"><span class="header-section-number">11.3</span> Demanda eléctrica</a>
  <ul class="collapse">
  <li><a href="#identificación-y-estimación-del-mejor-modelo-2" id="toc-identificación-y-estimación-del-mejor-modelo-2" class="nav-link" data-scroll-target="#identificación-y-estimación-del-mejor-modelo-2">Identificación y estimación del mejor modelo</a></li>
  <li><a href="#predicción-2" id="toc-predicción-2" class="nav-link" data-scroll-target="#predicción-2">Predicción</a></li>
  <li><a href="#análisis-del-error-1" id="toc-análisis-del-error-1" class="nav-link" data-scroll-target="#análisis-del-error-1">Análisis del error</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#otras-alternativas-para-ajustar-un-modelo-y-predecir" id="toc-otras-alternativas-para-ajustar-un-modelo-y-predecir" class="nav-link" data-scroll-target="#otras-alternativas-para-ajustar-un-modelo-y-predecir"><span class="header-section-number">12</span> Otras alternativas para ajustar un modelo y predecir</a></li>
  <li><a href="#resumen-de-los-comandos-utilizados" id="toc-resumen-de-los-comandos-utilizados" class="nav-link" data-scroll-target="#resumen-de-los-comandos-utilizados"><span class="header-section-number">13</span> Resumen de los comandos utilizados</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Técnicas de Alisado Exponencial</h1>
<p class="subtitle lead">Previsión con Datos Temporales (GBIA)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Iván Arribas (Depto. Análisis Económico. Universitat de València) </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><br>
<br>
</p>
<section id="introducción" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introducción</h1>
<p>Los métodos de alisado exponencial aparecen en los años 50 del siglo pasado de la mano de Brown, Holt y Winters <span class="citation" data-cites="Brown59 Holt Winters60">(véase <a href="#ref-Brown59" role="doc-biblioref">Brown 1959</a>; <a href="#ref-Holt" role="doc-biblioref">Holt 2004</a>; <a href="#ref-Winters60" role="doc-biblioref">Winters 1960</a>)</span> y han sido la raíz de uno de los métodos de predicción más sencillos y eficaces. La idea básica es predecir usando una media ponderada de los datos pasados, donde los más recientes tienen un peso mayor y este decae exponencialmente conforme usamos observaciones más antiguas.</p>
<p>El alisado exponencial es una familia de métodos de ajuste y previsión que ofrece muy buenos resultados para predicciones a corto plazo o para predecir series con pocos datos o <em>sencillas</em> (sin mucho <em>ruido</em>).</p>
<p>Suponen un grado de modelización mayor que los métodos sencillos vistos previamente, pero sin alcanzar la complejidad de otras metodologías (modelos ARIMA).</p>
<p>En origen, son métodos descriptivos con el único objetivo de producir <strong>predicciones puntuales</strong>. Sin embargo, su enfoque como modelos de <em>espacio de estados</em> posibilita un marco teórico para obtener <strong>intervalos de confianza de las predicciones</strong>.</p>
<p><br>
<br>
</p>
</section>
<section id="componentes-de-una-serie-en-el-contexto-del-alisado-exponencial" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Componentes de una serie en el contexto del alisado exponencial</h1>
<p>Para obtener una predicción en el periodo <span class="math inline">\(t+1\)</span> con datos hasta el periodo <span class="math inline">\(t\)</span> necesitamos tres componentes:</p>
<ul>
<li>La estimación del nivel de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(l_t\)</span></li>
<li>La estimación de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span>: <span class="math inline">\(b_t\)</span></li>
<li>La estimación de la estacionalidad en el mes correspondiente al periodo <span class="math inline">\(t+1\)</span> con datos hasta <span class="math inline">\(t\)</span>: <span class="math inline">\(s_{t + 1 - m}\)</span> (recuerda, <span class="math inline">\(m\)</span> es el orden estacional</li>
</ul>
<p>A partir de estas componentes, obtenidas en el periodo <span class="math inline">\(t\)</span> y para un esquema aditivo, se tendría que la predicción en el periodo <span class="math inline">\(t+1\)</span> es:</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t+b_t+s_{t+1-m}.\]</span></p>
<p>En general, las componentes pueden <strong>existir o no</strong> y se pueden combinar entre ellas <strong>aditiva o multiplicativamente</strong>. Veamos algunos casos:</p>
<ul>
<li>Existen todas y son multiplicativas:</li>
</ul>
<p><span class="math display">\[\widehat{y}_{t+1}=l_t \cdot b_t \cdot s_{t + 1 - m}\]</span></p>
<ul>
<li>Existen todas, nivel y pendiente aditivas, y estacionalidad multiplicativa:</li>
</ul>
<p><span class="math display">\[\widehat{y}_{t+1}=(l_t+b_t)s_{t + 1 - m}\]</span></p>
<ul>
<li>No hay pendiente y la estacionalidad es aditiva:</li>
</ul>
<p><span class="math display">\[\widehat{y}_{t+1}=l_t+s_{t + 1 - m}\]</span></p>
<p>¿Como obtenemos los valores de <span class="math inline">\(l_t\)</span>, <span class="math inline">\(b_t\)</span> y <span class="math inline">\(s_{t + 1 - m}\)</span>? Mediante <strong>expresiones recursivas</strong>, donde cada componente se calcula a partir de los valores hasta <span class="math inline">\(t\)</span> de la serie y de las componentes:</p>
<span class="math display">\[\begin{aligned}
l_t&amp; = f_l(y_t,y_{t-1}\ldots, l_{t-1},l_{t-2}\ldots,b_{t-1},b_{t-2}\ldots,s_{t-1},s_{t-2}\ldots) \\
b_t&amp; = f_b(y_t,y_{t-1}\ldots, l_{t},l_{t-1}\ldots,b_{t-1},b_{t-2}\ldots,s_{t-1},s_{t-2}\ldots) \\
s_t&amp; = f_s(y_t,y_{t-1}\ldots, l_{t},l_{t-1}\ldots,b_{t},b_{t-1}\ldots,s_{t-1},s_{t-2}\ldots)
\end{aligned}\]</span>
<p>Por ejemplo, el <em>método ingenuo I</em> se puede interpretar dentro de este contexto como un método de alisado donde <span class="math inline">\(l_t = y_t\)</span> y no hay ni pendiente ni estacionalidad. Por tanto, <span class="math inline">\(\widehat{y}_{t+1} = l_{t} = y_{t}\)</span>.</p>
<p>De la misma forma, el <em>método ingenuo II</em> se puede interpretar como un método de alisado donde <span class="math inline">\(l_t = y_t\)</span>, <span class="math inline">\(b_t = y_t - y_{t-1}\)</span> y no hay estacionalidad. Entonces, <span class="math inline">\(\widehat{y}_{t+1}=l_t + b_t = y_t + (y_t - y_{t-1})\)</span>.</p>
<p>En las expresiones previas hemos supuesto que se quería obtener una predicción a un periodo vista (<span class="math inline">\(\widehat{y}_{t+1}\)</span>). Si el objetivo es estimar una previsión <span class="math inline">\(h\)</span> periodos hacia delante desde el periodo <span class="math inline">\(t\)</span>, <span class="math inline">\(\widehat{y}_{t+h}\)</span>, hay que modificar la ecuación de predicción adecuadamente. Por ejemplo, para el caso aditivo se tendría que</p>
<p><span class="math display">\[\widehat{y}_{t+h} = l_t+hb_t+s_{t+h-m(k+1)}\]</span> donde <span class="math inline">\(k = \lfloor (h-1)/m\rfloor\)</span>.</p>
<p>El concepto de componentes aquí visto no coincide con el definido en el Tema 1. Sin embargo, podemos asimilar la tendencia de una serie como la suma (o multiplicación) del nivel y la pendiente <span class="math inline">\(T_{t+1} = l_t + b_t\)</span> (o <span class="math inline">\(T_{t+1} = l_t \cdot b_t\)</span>) y de esta forma ambas definiciones de componentes de una serie se hacen compatibles.</p>
<p><br>
<br>
</p>
</section>
<section id="casos-posibles" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Casos posibles</h1>
<p>Todas las series tiene nivel, pero dependiendo del tipo de pendiente y estacionalidad hay 15 casos posibles, mostrados en la <a href="#tbl-taxonomia">Tabla&nbsp;1</a>.</p>
<div id="tbl-taxonomia" class="anchored">
<table class="table">
<caption>Tabla&nbsp;1: Casos de alisado según el tipo de tendencia y estacionalidad</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 24%">
<col style="width: 24%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Tendencia</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Estacionalidad</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: center;">Ninguna (N)</td>
<td style="text-align: center;">Aditiva (A)</td>
<td style="text-align: center;">Multiplicativa (M)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ninguna (N)</td>
<td style="text-align: center;"><strong>N, N</strong></td>
<td style="text-align: center;">N, A</td>
<td style="text-align: center;">N, M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Aditiva (A)</td>
<td style="text-align: center;"><strong>A, N</strong></td>
<td style="text-align: center;"><strong>A, A</strong></td>
<td style="text-align: center;"><strong>A, M</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Aditiva Amortiguada (Ad)</td>
<td style="text-align: center;"><strong>Ad, N</strong></td>
<td style="text-align: center;">Ad, A</td>
<td style="text-align: center;">Ad, M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Multiplicativa (M)</td>
<td style="text-align: center;">M, N</td>
<td style="text-align: center;">M, A</td>
<td style="text-align: center;">M, M</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplicativa Amortiguada (Md)</td>
<td style="text-align: center;">Md, N</td>
<td style="text-align: center;">Md, A</td>
<td style="text-align: center;">Md, M</td>
</tr>
</tbody>
</table>
</div>
<p>Cada caso difiere en las componentes que se observan y su esquema, dando lugar a un conjunto diferente de ecuaciones recursivas de actualización.</p>
<p>Si se añade que el error puede ser aditivo (A) o multiplicativo (M), da 30 posibilidades. El tipo de error (aditivo o multiplicativo) es relevante en el cálculo del intervalo de confianza de las predicciones.</p>
<p>Los modelos más usuales son (error, tendencia, estacionalidad):</p>
<ul>
<li>(A, N, N): Alisado exponencial simple</li>
<li>(A, A, N): Alisado de Holt</li>
<li>(A, Ad, N): Alisado con tendencia amortiguada (d de <em>damped</em>)</li>
<li>(A, A, A): Alisado de Holt-Winters aditivo</li>
<li>(M, A, M): Alisado de Holt-Winters multiplicativo</li>
</ul>
<p>Acude al artículo de <span class="citation" data-cites="Hyndman08">Hyndman and Khandakar (<a href="#ref-Hyndman08" role="doc-biblioref">2008</a>)</span> para saber más de cada modelo, o al libro de <span class="citation" data-cites="Hyndman08b">Hyndman et al. (<a href="#ref-Hyndman08b" role="doc-biblioref">2008</a>)</span>.</p>
<p><br>
</p>
<section id="las-funciones-ets-y-forecast" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="las-funciones-ets-y-forecast"><span class="header-section-number">3.1</span> Las funciones <code>ets</code> y <code>forecast</code></h2>
<p>Podemos estimar cualquiera de los treinta modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</p>
<ul>
<li>El tipo de modelo en <code>ets</code> se especifica con el argumento <code>model</code>, un código de tres letras indicando el tipo de Error, Tendencia y eStacionalidad (ETS). Por ejemplo, <code>model = "ANN"</code> indica un modelo con error aditivo, sin tendencia ni estacionalidad, es decir, el alisado exponencial simple; <code>model = "AAN"</code> indica un modelo con error aditivo, pendiente aditiva, pero sin estacionalidad, el alisado exponencial de Holt. El alisado exponencial de Holt-Winters multiplicativo sería <code>model = "AAM"</code>.</li>
<li>Si se desea incluir amortiguamiento, hay que añadir el argumento <code>damped = TRUE</code>.</li>
<li>Por defecto <code>ets</code> no considera modelos con tendencia multiplicativa (últimas dos líneas de la <a href="#tbl-taxonomia">Tabla&nbsp;1</a>). Debes fijar el parámetro <code>allow.multiplicative.trend=TRUE</code> para contemplar esta opción.</li>
</ul>
<p>A diferencia de las funciones vistas en el Tema 3 (<code>naive</code>, <code>meanf</code>, <code>rwf</code> y <code>snaive</code>), la función <code>ets</code> solo estima los modelos, pero no produce predicciones. Para ello habrá que usar la función <code>forecast</code> sobre un modelo estimado con <code>ets</code>. El principal argumento de esta función es <code>h</code> que especifica el horizonte temporal de predicción. También puedes usar <code>level</code> para fijar el nivel de confianza del intervalo de predicción.</p>
<p>Mira la ayuda de <code>R</code> para ver una explicación detallada de los argumentos de estas las funciones <code>ets</code> y <code>forecast</code>.</p>
<p><br>
<br>
</p>
</section>
</section>
<section id="alisado-exponencial-simple-a-n-n" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Alisado exponencial simple (A, N, N)</h1>
<p><br>
</p>
<section id="definición" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="definición"><span class="header-section-number">4.1</span> Definición</h2>
<p>El alisado exponencial simple es adecuado para una serie estacionaria y sin estacionalidad. Es decir, una serie que se mueve alrededor de un nivel constante.</p>
<p>La ecuación de la <strong>predicción intramuestral</strong> es</p>
<p><span class="math display">\[\widehat{y}_{t+1} = \alpha y_t + \alpha (1-\alpha) y_{t-1} + \alpha (1-\alpha)^2 y_{t-2} + \alpha (1-\alpha)^3 y_{t-3} + \ldots =  \alpha y_t + (1-\alpha)\widehat{y}_{t},\]</span> donde <span class="math inline">\(0 \leq \alpha \leq 1\)</span> es el parámetro de suavizado. La primera <strong>predicción extramuestral</strong> queda</p>
<p><span class="math display">\[\widehat{y}_{T+1}=\alpha y_T + (1-\alpha)\widehat{y}_{T}\]</span> y para las restantes</p>
<p><span class="math display">\[\widehat{y}_{T+h} = \widehat{y}_{T+1}.\]</span><br>
</p>
</section>
<section id="formulas-interactivas-de-sus-componentes" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="formulas-interactivas-de-sus-componentes"><span class="header-section-number">4.2</span> Formulas interactivas de sus componentes</h2>
<p>En el alisado exponencial simple solo hay una componente, el nivel <span class="math inline">\(l_t\)</span>.</p>
<ul>
<li>La <strong>ecuación recursiva</strong> de suavizado es <span class="math inline">\(l_t=\alpha y_t + (1-\alpha)l_{t-1}\)</span></li>
<li>La ecuación de <strong>predicción intramuestral</strong> es <span class="math inline">\(\widehat{y}_{t+1} = l_t\)</span></li>
<li>La ecuación de <strong>predicción extramuestral</strong> es <span class="math inline">\(\widehat{y}_{T+h} = \widehat{y}_{T+1} = l_T\)</span></li>
</ul>
<p>Dos estimaciones razonables de <span class="math inline">\(l_t\)</span>, el nivel de la serie en el periodo <span class="math inline">\(t\)</span>, son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span> y el nivel del periodo previo <span class="math inline">\(l_{t-1}\)</span>. La estimación final de <span class="math inline">\(l_t\)</span> es una media ponderada de ambas y esta estimación final es la previsión de la serie para el periodo siguiente.</p>
<p><br>
</p>
</section>
<section id="estimación-de-los-parámetros-del-modelo" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo"><span class="header-section-number">4.3</span> Estimación de los parámetros del modelo</h2>
<p>Dado el proceso iterativo para el cálculo de <span class="math inline">\(l_t\)</span> se necesita un <strong>valor inicial</strong> de arranque <span class="math inline">\(l_0\)</span>. Cada programa estadístico usa su propio método para obtener <span class="math inline">\(l_0\)</span>.</p>
<p>Respecto de <span class="math inline">\(\alpha\)</span>, usualmente se estima el valor <strong>optimo</strong> según un criterio de precisión de la predicción. El parámetro <span class="math inline">\(\alpha\)</span> <strong>se puede interpretar</strong>:</p>
<ul>
<li>Si <span class="math inline">\(\alpha = 1\)</span> se tiene el <em>método ingenuo I</em> (<span class="math inline">\(\widehat{y}_{t+1}=y_t\)</span>), óptimo cuando el nivel de la serie varía constantemente en el tiempo.</li>
<li>Si <span class="math inline">\(\alpha = 0\)</span> se tiene <span class="math inline">\(\widehat{y}_{t} =l_0\)</span>, óptimo cuando el nivel permanece constante en el tiempo.</li>
</ul>
<p>En concreto, <code>ets</code> estima por defecto los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(l_0\)</span> maximizando la función de verosimilitud. Esta búsqueda está restringida a <span class="math inline">\(0 &lt; \alpha &lt; 1\)</span>. Es decir el parámetro <span class="math inline">\(\alpha\)</span> nunca puede ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
<p><br>
</p>
</section>
<section id="ejemplo" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="ejemplo"><span class="header-section-number">4.4</span> Ejemplo</h2>
<p>Vamos a usar el método de alisado exponencial simple para predecir la serie Demanda eléctrica semanal desde la primera semana de febrero (semana 6 del año) hasta la última semana completa de mayo (semana 22 del año), en total 17 semanas. Usaremos para ello la función <code>ets</code> con `model = “ANN”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Consumo electrico.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(electricidad[, <span class="dv">1</span>],</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Nos quedamos con los meses de febrero a mayo.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">window</span>(electricidad, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">7</span>)) </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Creamos la serie de consumo semanal</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>electricidadSemanal <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(electricidad, <span class="at">FUN =</span> sum) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>electricidadEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(electricidadSemanal, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"ANN"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidadEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,N,N) 

Call:
 ets(y = electricidadSemanal, model = "ANN") 

  Smoothing parameters:
    alpha = 0.5912 

  Initial states:
    l = 5101.1606 

  sigma:  175.1913

     AIC     AICc      BIC 
227.6767 229.5229 230.1764 

Training set error measures:
                   ME     RMSE      MAE       MPE     MAPE      MASE       ACF1
Training set -44.6217 164.5636 99.49524 -1.008795 2.167762 0.8915993 -0.1809408</code></pre>
</div>
</div>
<p>Veamos la salida en detalle:</p>
<ul>
<li>El valor de <span class="math inline">\(\alpha\)</span> que optimiza el criterio usado para medir la calidad del ajuste es <span class="math inline">\(\alpha =\)</span> 0.59, un valor intermedio, ni cercano a 0 ni cercano a 1. Es decir, la serie Demanda eléctrica cambia de nivel poco a poco.</li>
<li>El valor de arranque <span class="math inline">\(l_0\)</span> óptimo es 5101.16.</li>
<li><em>sigma</em> es la desviación típica del error (aditivo) de predicción. Se diferencia de RMSE en el denominador. Para calcular <em>sigma</em> en lugar de dividir por <span class="math inline">\(T\)</span> se divide por <span class="math inline">\(T\)</span> menos el número de parámetros estimados, en este caso 3: <span class="math inline">\(l_0\)</span>, <span class="math inline">\(\alpha\)</span> y <em>sigma</em>. Sí, <em>sigma</em>, se considerará siempre otro parámetro estimado.</li>
<li>La calidad del ajuste es bueno, como evidencia el error porcentual medio del 2.2%.</li>
</ul>
<p>En el objeto <code>electricidadEts</code> la matriz <code>electricidadEts$states</code> guarda todos los valores del nivel obtenidos con la ecuación recursiva, incluido el valor de arranque, así que es una matriz con <span class="math inline">\(T+1\)</span> filas (18 en el ejemplo). Puedes ver el valor de <span class="math inline">\(l_{22}\)</span> de la última semana completa de mayo de 2022 (semana 22 del año) en su última fila, que vale 4652.69.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(electricidadEts<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 22 
End = 22 
Frequency = 1 
            l
[1,] 4652.686</code></pre>
</div>
</div>
<p>Así, la predicción para la primera semana de junio es <span class="math inline">\(\widehat{y}_{23}=l_{22}=\)</span> 4652.69. Igualmente <span class="math inline">\(\widehat{y}_{24}=l_{22}=\)</span> 4652.69. Es decir, todas las previsiones son iguales a <span class="math inline">\(l_{22}\)</span>.</p>
<p>Mediante la función <code>forecast</code> podemos predecir los casos de Demanda eléctrica para las próximas 5 semanas. Por tratarse de un modelo sin pendiente ni estacionalidad, la predicción es constante en el tiempo. Recuerda que <span class="math inline">\(\widehat{y}_{T+h} = l_T\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>electricidadf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(electricidadEts,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>electricidadf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Point Forecast    Lo 95    Hi 95
23       4652.686 4309.317 4996.055
24       4652.686 4253.797 5051.575
25       4652.686 4205.112 5100.261
26       4652.686 4161.226 5144.146
27       4652.686 4120.949 5184.423</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadANN">Figura&nbsp;1</a> muestra la serie Demanda eléctrica, las previsiones extramuestrales que son constantes y el intervalo de confianza. Conforme aumentamos el horizonte de predicción, el intervalo de confianza es más amplio como reflejo de la mayor incertidumbre en la predicción.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadf,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadANN" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-electricidadANN-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;1: Consumo semanal de electricidad (febrero a mayo 2022) y predicción con alisado simple</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="alisado-exponencial-de-holt-a-a-n" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Alisado exponencial de Holt (A, A, N)</h1>
<p>El alisado exponencial de Holt es adecuado para una serie no estacionaria y sin estacionalidad.</p>
<p><br>
</p>
<section id="formulas-interactivas-de-sus-componentes-1" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="formulas-interactivas-de-sus-componentes-1"><span class="header-section-number">5.1</span> Formulas interactivas de sus componentes</h2>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<span class="math display">\[\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1}
\end{aligned}\]</span>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es</p>
<p><span class="math display">\[\widehat{y}_{t+1} = l_t + b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + h b_T.\]</span></p>
<p>Dos estimaciones razonables del nivel de la serie en el periodo <span class="math inline">\(t\)</span> son el valor observado para la serie en ese periodo <span class="math inline">\(y_t\)</span>, y una estimación del nivel del periodo <span class="math inline">\(t\)</span> realizada desde el periodo <span class="math inline">\(t-1\)</span>: <span class="math inline">\(l_{t-1} + b_{t-1}\)</span>. Por otro lado, dos estimaciones razonables de la pendiente de la serie en el periodo <span class="math inline">\(t\)</span> son el cambio de nivel de <span class="math inline">\(t-1\)</span> a <span class="math inline">\(t\)</span> (el último observado) <span class="math inline">\(l_t-l_{t-1}\)</span>, y el valor de la pendiente en el periodo previo, <span class="math inline">\(b_{t-1}\)</span>. En ambos casos, nivel y pendiente, la estimación final es una media ponderada, parametrizada por <span class="math inline">\(0 \leq \alpha, \: \beta \leq 1\)</span>.</p>
<p>Observa que el <em>método ingenuo II</em> es un caso concreto de Alisado de Holt. Si hacemos <span class="math inline">\(\alpha=\beta = 1,\)</span> queda <span class="math inline">\(l_t=y_t\)</span> y <span class="math inline">\(b_t=y_t-y_{t-1}\)</span>, por tanto</p>
<p><span class="math display">\[\widehat{y}_{t+1}=l_t + b_t = y_t + (y_t - y_{t-1}).\]</span></p>
<p>y</p>
<p><span class="math display">\[\widehat{y}_{T+h}=l_T + h \cdot b_T = y_T + h(y_T - y_{T-1}).\]</span></p>
<p><br>
</p>
</section>
<section id="estimación-de-los-parámetros-del-modelo-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="estimación-de-los-parámetros-del-modelo-1"><span class="header-section-number">5.2</span> Estimación de los parámetros del modelo</h2>
<p>Para aplicar este método es necesario estimar unos valores iniciales <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> de las ecuaciones recursivas e identificar los valores más adecuados de los parámetros <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span>.</p>
<p>La función <code>ets</code> estima por defecto los parámetros <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(l_0\)</span> y <span class="math inline">\(b_0\)</span> maximizando la función de verosimilitud. En este caso la búsqueda está restringida a <span class="math inline">\(0 &lt; \beta &lt; \alpha &lt; 1\)</span>. Por tanto, <span class="math inline">\(\alpha\)</span> y <span class="math inline">\(\beta\)</span> nunca pueden ser 0 o 1 y en la práctica sus valores limite son 0.0001 y 0.9999.</p>
<p>La interpretación del parámetro <span class="math inline">\(\alpha\)</span> es similar al caso del alisado exponencial simple.</p>
<p><strong>Interpretación del parámetro</strong> <span class="math inline">\(\beta\)</span>:</p>
<ul>
<li>Si <span class="math inline">\(\beta = 1\)</span>, <span class="math inline">\(b_t = l_t - l_{t-1}\)</span>, la pendiente se actualiza constantemente porque varía periodo a periodo Puede ser un indicador de mal ajuste (tendencia no lineal o pendiente no aditiva).</li>
<li>Si <span class="math inline">\(\beta = 0\)</span>, <span class="math inline">\(b_t = b_{t-1}= \ldots = b_0\)</span>, la pendiente se mantiene constante en el tiempo.</li>
</ul>
<p><br>
</p>
</section>
<section id="ejemplo-1" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="ejemplo-1"><span class="header-section-number">5.3</span> Ejemplo</h2>
<p>Vamos a usar el método de alisado de Holt para predecir la serie Libros. Usaremos para ello la función <code>ets</code> con los argumentos <code>model = "AAN"</code> y <code>damped = FALSE</code>. El segundo argumento previene el uso de tendencia amortiguada que veremos en el siguiente epígrafe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>libros <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/libros.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>libros <span class="ot">&lt;-</span> <span class="fu">ts</span>(libros[, <span class="dv">2</span>], </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">start =</span> <span class="dv">1993</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">frequency  =</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>librosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(libros, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">model =</span> <span class="st">"AAN"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(librosEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,N) 

Call:
 ets(y = libros, model = "AAN", damped = FALSE) 

  Smoothing parameters:
    alpha = 0.9461 
    beta  = 0.0001 

  Initial states:
    l = 43015.3558 
    b = 866.6661 

  sigma:  6235.705

     AIC     AICc      BIC 
566.5129 569.3700 572.9921 

Training set error measures:
                    ME     RMSE     MAE        MPE    MAPE      MASE
Training set -91.75606 5755.295 4179.61 -0.3817069 6.68946 0.9237963
                    ACF1
Training set 0.004201274</code></pre>
</div>
</div>
<p>Los valores óptimos de los cuatro parámetros son <span class="math inline">\(\alpha=\)</span> 0.95, <span class="math inline">\(\beta=\)</span> 0, <span class="math inline">\(l_0 =\)</span> 43015.36 y <span class="math inline">\(b_0 =\)</span> 866.67. Observa que <span class="math inline">\(\alpha\)</span> es prácticamente 1 y que <span class="math inline">\(\beta\)</span> es cero. Si aplicamos estos valores de los parámetros a las ecuaciones recursivas y la predicción extramuestral, obtenemos <span class="math inline">\(y_{T+h}=y_T + hb_0\)</span>: la predicción es el último valor observado más <span class="math inline">\(h\)</span> veces la primera pendiente estimada. La calidad de las predicciones es razonable, con un error porcentual medio del 6.7%.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado (y la respuesta no es 4)? ¿Cuál es el denominador en el cálculo de RMSE y de <em>sigma</em>?</p>
</div>
</div>
<p>En el objeto <code>librosEts</code> la matriz <code>librosEts$states</code> guarda todos los valores obtenidos con las ecuaciones recursivas, en este caso el nivel y la pendiente, incluidos los valores de arranque. Puedes ver los valores de <span class="math inline">\(l_{2019}\)</span> y <span class="math inline">\(b_{2019}\)</span> en su última fila, que valen respectivamente 64091.02, 866.42.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(librosEts<span class="sc">$</span>states, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 2019 
End = 2019 
Frequency = 1 
            l        b
2019 64091.02 866.4181</code></pre>
</div>
</div>
<p>Así, la predicción para <span class="math inline">\(2020\)</span> es <span class="math inline">\(\widehat{y}_{2020}=l_{2019} + b_{2019}=\)</span> 64091.02 <span class="math inline">\(+\)</span> 866.42 <span class="math inline">\(=\)</span> 64957.43. Igualmente <span class="math inline">\(\widehat{y}_{2021}=l_{2019} + 2\cdot b_{2019}=\)</span> 65823.85. Es decir, el incremento entre previsiones es constante e igual a <span class="math inline">\(b_{2019}\)</span> que, por ser <span class="math inline">\(\beta\)</span> prácticamente nulo, coincide con <span class="math inline">\(b_0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>librosf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(librosEts,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">h =</span> <span class="dv">5</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>librosf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2020       64957.43 52735.68 77179.19
2021       65823.85 48998.58 82649.13
2022       66690.27 46273.69 87106.85
2023       67556.69 44091.57 91021.81
2024       68423.11 42261.77 94584.44</code></pre>
</div>
</div>
<p>La <a href="#fig-librosAAN">Figura&nbsp;2</a> muestra la serie Libros y las previsiones extramuestrales que muestran una ligera tendencia creciente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(librosf,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Títulos"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-librosAAN" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-librosAAN-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;2: Libros y predicción con alisado de Holt</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="alisado-exponencial-con-pendiente-amortiguada-a-ad-n" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Alisado exponencial con pendiente amortiguada (A, Ad, N)</h1>
<p>Las previsiones con el método de Holt presentan siempre una pendiente constante. En previsiones a corto plazo esto no es un problema, pero para previsiones a largo plazo la experiencia indica que suele aparecer un sesgo de previsión. El alisado exponencial con pendiente amortiguada trata de corregir esta limitación. El mecanismo, propuesto por <span class="citation" data-cites="Gardner85">Gardner and Mckenzie (<a href="#ref-Gardner85" role="doc-biblioref">1985</a>)</span>, es introducir un nuevo parámetro <span class="math inline">\(0 \leq \phi \leq 1\)</span> que <em>amortigua</em> la tendencia hasta hacerla plana en el largo plazo.</p>
<p><br>
</p>
<section id="formulas-interactivas-de-sus-componentes-2" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="formulas-interactivas-de-sus-componentes-2"><span class="header-section-number">6.1</span> Formulas interactivas de sus componentes</h2>
<p>Las <strong>ecuaciones recursivas</strong> son</p>
<span class="math display">\[\begin{aligned}
l_t &amp; =\alpha y_t + (1-\alpha)(l_{t-1}+\phi b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)\phi b_{t-1}
\end{aligned}\]</span>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1} = l_t + \phi b_t,\]</span> de forma que la ecuación de <strong>predicción extramuestral</strong> es <span class="math display">\[\widehat{y}_{T+h}=l_T + (\phi + \phi^2 + \ldots + \phi^h) b_T.\]</span></p>
<p>Como observas, se ha añadido un nuevo parámetro <span class="math inline">\(\phi\)</span>, que acompaña siempre a la pendiente <span class="math inline">\(b_t\)</span>. Si <span class="math inline">\(\phi = 1\)</span>, se tiene el alisado de Holt y si <span class="math inline">\(\phi = 0\)</span>, se tiene el alisado simple. Para valores entre <span class="math inline">\(0\)</span> y <span class="math inline">\(1\)</span> en el corto plazo las predicciones tienen pendiente y en el largo plazo se hacen constantes e iguales a <span class="math inline">\(l_T + \phi b_T/(1 - \phi)\)</span>.</p>
<p>Por razones prácticas el rango de búsqueda de <span class="math inline">\(\phi\)</span> queda en el intervalo <span class="math inline">\([0.8, 0.98]\)</span>. Si el valor óptimo de <span class="math inline">\(\phi\)</span> fuera su valor máximo de <span class="math inline">\(0.98\)</span> o muy cercano a este valor, cabría plantearse si no sería más adecuado un modelo sin amortiguamiento.</p>
<p><br>
</p>
</section>
<section id="ejemplo-2" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="ejemplo-2"><span class="header-section-number">6.2</span> Ejemplo</h2>
<p>Vamos a usar el método de alisado con amortiguamiento para predecir, una vez más, la serie Libros añadiendo a la función <code>ets</code> el argumento <code>damped = TRUE</code>. En este caso, para ver el efecto del <em>amortiguamiento</em> vamos a pedir un horizonte temporal más largo.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>librosEtsD <span class="ot">&lt;-</span> <span class="fu">ets</span>(libros, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="st">"AAN"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">damped =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(librosEtsD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,Ad,N) 

Call:
 ets(y = libros, model = "AAN", damped = TRUE) 

  Smoothing parameters:
    alpha = 0.8971 
    beta  = 0.0001 
    phi   = 0.9083 

  Initial states:
    l = 41396.6242 
    b = 2881.012 

  sigma:  6239.024

     AIC     AICc      BIC 
567.3414 571.5414 575.1164 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -159.4816 5631.786 3984.248 -0.6273468 6.314471 0.8806165
                   ACF1
Training set 0.01091024</code></pre>
</div>
</div>
<p>El valor óptimo del parámetro <span class="math inline">\(\phi\)</span> es <span class="math inline">\(0.91\)</span> y el error porcentual 6.3%, algo inferior al obtenido con el alisado de Holt sin amortiguamiento. La inclusión de un nuevo parámetro en el modelo mejora el ajuste.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Parámetros estimados
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Cuántos parámetros se han estimado en este caso? ¿Cuáles?</p>
</div>
</div>
<p>La <a href="#fig-librosAAdN">Figura&nbsp;3</a> muestra la serie Libros, su estimación (intramuestral) y las predicciones a 15 años vista. Observa que la pendiente de las previsiones se <em>amortigua</em> en el tiempo, de forma que al principio las previsiones crecen más rápidamente que en los últimos años.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>librosfD <span class="ot">&lt;-</span> <span class="fu">forecast</span>(librosEtsD, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">h =</span> <span class="dv">15</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>librosfD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95     Hi 95
2020       64148.96 51920.70  76377.22
2021       64325.91 47897.02  80754.81
2022       64486.65 44730.42  84242.88
2023       64632.65 42033.33  87231.96
2024       64765.27 39642.22  89888.32
2025       64885.73 37469.99  92301.47
2026       64995.15 35463.92  94526.37
2027       65094.54 33589.35  96599.73
2028       65184.82 31822.06  98547.58
2029       65266.82 30144.45 100389.20
2030       65341.31 28543.22 102139.40
2031       65408.97 27008.10 103809.84
2032       65470.43 25530.94 105409.92
2033       65526.26 24105.17 106947.34
2034       65576.97 22725.40 108428.54</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(librosfD,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Títulos"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-librosAAdN" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-librosAAdN-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;3: Libros y predicción con alisado exponencial con amortiguamiento</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="alisado-de-holt-winters-aditivo-a-a-a-y-multiplicativo-m-a-m" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Alisado de Holt-Winters aditivo (A, A, A) y multiplicativo (M, A, M)</h1>
<p>El método de alisado exponencial de Holt-Winters es adecuado para una serie con tendencia y estacionalidad. Existen dos versiones según que el esquema sea aditivo o multiplicativo.</p>
<p><br>
</p>
<section id="alisado-de-holt-winters-aditivo-a-a-a" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="alisado-de-holt-winters-aditivo-a-a-a"><span class="header-section-number">7.1</span> Alisado de Holt-Winters aditivo (A, A, A)</h2>
<p>Las <strong>ecuaciones recursivas</strong> de actualización son:</p>
<span class="math display">\[\begin{aligned}
l_t &amp; =\alpha (y_t - s_{t-m} ) + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp; =\gamma (y_t - l_{t-1} - b_{t-1}) + (1 - \gamma)s_{t-m}
\end{aligned}\]</span>
<p>con <span class="math inline">\(0 \leq \alpha, \beta, \gamma \leq 1\)</span>.</p>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1}  = l_t + b_t + s_{t+1-m},\]</span> de forma que la ecuación de <strong>predicción extramuestral es</strong>: <span class="math display">\[\widehat{y}_{T+h}=l_T + h b_T + s_{T+h - m(k+1)},\]</span> con <span class="math inline">\(k = \lfloor(h-1)/m\rfloor\)</span>.</p>
<p><br>
</p>
</section>
<section id="alisado-de-holt-winters-multiplicativo-m-a-m" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="alisado-de-holt-winters-multiplicativo-m-a-m"><span class="header-section-number">7.2</span> Alisado de Holt-Winters multiplicativo (M, A, M)</h2>
<p>Las <strong>ecuaciones recursivas</strong> de actualización son:</p>
<span class="math display">\[\begin{aligned}
l_t &amp; =\alpha \frac{y_t}{s_{t-m}} + (1-\alpha)(l_{t-1}+b_{t-1}) \\
b_t &amp; =\beta (l_t - l_{t-1}) + (1-\beta)b_{t-1} \\
s_t &amp; =\gamma \frac{y_t}{l_{t-1} + b_{t-1}} + (1 - \gamma)s_{t-m}
\end{aligned}\]</span>
<p>La ecuación de la <strong>predicción intramuestral</strong> a un periodo vista es <span class="math display">\[\widehat{y}_{t+1}  = (l_t + b_t)s_{t+1-m},\]</span> de forma que la ecuación de <strong>predicción extramuestral es</strong>: <span class="math display">\[\widehat{y}_{T+h}=(l_T + h b_T)s_{T+h - m(k+1)}.\]</span></p>
<p><br>
</p>
</section>
<section id="ejemplo-con-demanda-electrica" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="ejemplo-con-demanda-electrica"><span class="header-section-number">7.3</span> Ejemplo con Demanda electrica</h2>
<p>Vamos a usar el método de <strong>Holt-Winters Aditivo</strong> para predecir la serie Demanda eléctrica, que presentaba un esquema aditivo. Para ello usaremos la función <code>ets</code> con el argumento <code>model = "AAA"</code> (y <code>damped = FALSE</code>). Vamos a considerar la serie desde el 31 de enero (lunes) hasta el 29 de mayo (domingo), 17 semanas, y pedir una previsión a dos semanas vista.</p>
<p>En el proceso de estimación, el parámetro <span class="math inline">\(\gamma\)</span> que gobierna la componente estacional está restringido a <span class="math inline">\(0 &lt; \gamma &lt; 1 - \alpha\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/Consumo electrico.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">ts</span>(electricidad[, <span class="dv">1</span>],</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">frequency =</span> <span class="dv">7</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Nos quedamos con los meses de febrero a mayo.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>electricidad <span class="ot">&lt;-</span> <span class="fu">window</span>(electricidad, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">7</span>)) </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>electricidadEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(electricidad, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"AAA"</span>, </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidadEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
 ets(y = electricidad, model = "AAA", damped = FALSE) 

  Smoothing parameters:
    alpha = 0.9995 
    beta  = 0.0001 
    gamma = 0.0001 

  Initial states:
    l = 744.5107 
    b = -0.4279 
    s = -90.7869 -45.8445 24.1349 31.8978 36.7843 33.9753
           9.8391

  sigma:  19.3728

     AIC     AICc      BIC 
1286.574 1289.518 1319.924 

Training set error measures:
                     ME     RMSE      MAE         MPE     MAPE      MASE
Training set -0.1920454 18.45569 11.78346 -0.06782005 1.802602 0.4649929
                   ACF1
Training set 0.04506439</code></pre>
</div>
</div>
<p>Los valores óptimos de los parámetros son <span class="math inline">\(\alpha=\)</span> 1, <span class="math inline">\(\beta=\)</span> 0 y <span class="math inline">\(\gamma=\)</span> 0. Los valores nulos para <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, permanecen constantes en el tiempo. La calidad de las predicciones es notable, con un error porcentual medio del 1.8%.</p>
<p>Los últimos valores de las componentes son</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(electricidadEts<span class="sc">$</span>states)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>      l       b      s1      s2      s3      s4      s5      s6      s7 
670.293  -0.430 -90.791 -45.840  24.135  31.896  36.785  33.972   9.841 </code></pre>
</div>
</div>
<p>Como el último dato de la serie es domingo 29 de mayo, los valores del nivel <span class="math inline">\(l\)</span> y la pendiente <span class="math inline">\(b\)</span> mostrados corresponden a ese día. Sin embargo, la componente estacional tiene un orden muy peculiar: s1 es el valor estacional para domingo (día del último dato), s2 el de sábado, s3 de viernes, hasta s7 que sería lunes. Podemos reproducir las predicciones para los próximos 7 días, 30 de mayo a 5 de junio (ojo, el etiquetado de la salida no tiene sentido):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)<span class="sc">*</span>electricidadEts<span class="sc">$</span>states[TT, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  electricidadEts<span class="sc">$</span>states[TT, <span class="dv">9</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      s7       s6       s5       s4       s3       s2       s1 
679.7032 703.4046 705.7874 700.4685 692.2764 621.8714 576.4903 </code></pre>
</div>
</div>
<p>O mejor usar la función <code>forecast</code> para obtener las predicciones y sus intervalos a dos semanas vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>electricidadf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(electricidadEts,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">14</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>electricidadf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
23.00000       679.7032 641.7332 717.6731
23.14286       703.4046 649.7171 757.0921
23.28571       705.7874 640.0358 771.5390
23.42857       700.4685 624.5443 776.3927
23.57143       692.2764 607.3884 777.1645
23.71429       621.8714 528.8780 714.8648
23.85714       576.4903 476.0421 676.9385
24.00000       676.6920 569.3025 784.0815
24.14286       700.3934 586.4849 814.3019
24.28571       702.7762 582.7008 822.8516
24.42857       697.4573 571.5156 823.3991
24.57143       689.2653 557.7174 820.8131
24.71429       618.8603 481.9345 755.7860
24.85714       573.4791 431.3779 715.5803</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadAAA">Figura&nbsp;4</a> muestra la serie Demanda eléctrica y las previsiones extramuestrales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadf,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadAAA" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-electricidadAAA-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;4: Demanda eléctrica y predicción con alisado de Holt-Winters aditivo</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
</p>
</section>
<section id="ejemplo-con-nacimientos" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="ejemplo-con-nacimientos"><span class="header-section-number">7.4</span> Ejemplo con Nacimientos</h2>
<p>Vamos a usar el método de <strong>Holt-Winters multiplicativo</strong> para predecir la serie Nacimientos, que presentaba un esquema multiplicativo. En este caso usaremos el argumento <code>model = "MAM"</code> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Vamos a considerar la serie Nacimientos desde enero de 2000 y pedir una previsión a dos años vista.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"./series/nacimientos.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>nacimientos <span class="ot">&lt;-</span> <span class="fu">ts</span>(nacimientos[, <span class="dv">2</span>],</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1975</span>, <span class="dv">1</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>nacimientosb <span class="ot">&lt;-</span> <span class="fu">window</span>(nacimientos, <span class="at">start =</span> <span class="dv">2000</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>nacimientosbEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">model =</span> <span class="st">"MAM"</span>, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosbEts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,A,M) 

Call:
 ets(y = nacimientosb, model = "MAM", damped = FALSE) 

  Smoothing parameters:
    alpha = 0.5267 
    beta  = 0.0322 
    gamma = 0.0474 

  Initial states:
    l = 33033.5584 
    b = 132.3618 
    s = 0.9949 0.9946 1.0457 1.0364 1.0274 1.0425
           0.9816 1.0158 0.9621 0.995 0.9072 0.9966

  sigma:  0.028

     AIC     AICc      BIC 
5374.038 5376.410 5435.585 

Training set error measures:
                    ME     RMSE      MAE         MPE     MAPE      MASE
Training set -15.26284 901.2576 684.0782 -0.08154216 1.974927 0.4907011
                   ACF1
Training set 0.05530167</code></pre>
</div>
</div>
<p>Los valores óptimos de los parámetros son <span class="math inline">\(\alpha=\)</span> 0.53, <span class="math inline">\(\beta=\)</span> 0.03 y <span class="math inline">\(\gamma=\)</span> 0.05. Los valores tan bajos para <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, modifican su valor muy lentamente. La calidad de las predicciones es notable, con un error porcentual medio del 2.0%.</p>
<p>Los últimos valores de las componentes son</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nacimientosbEts<span class="sc">$</span>states)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>nacimientosbEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>        l         b        s1        s2        s3        s4        s5        s6 
27846.854   -18.102     0.990     0.995     1.051     1.039     1.034     1.045 
       s7        s8        s9       s10       s11       s12 
    0.982     1.008     0.959     0.997     0.907     0.994 </code></pre>
</div>
</div>
<p>Como el último dato de la serie es diciembre de 2022, los valores del nivel <span class="math inline">\(l\)</span> y la pendiente <span class="math inline">\(b\)</span> mostrados corresponden a ese mes. Sin embargo, recuerda que la componente estacional sigue un orden inverso: s1 es el valor estacional para diciembre (mes del último dato), s2 el de noviembre, s3 de octubre, hasta s11 que sería febrero y s12 que es enero.</p>
<p>Podemos reproducir las predicciones para los primeros 12 meses de enero a diciembre (ojo, el etiquetado de la salida no es correcto) para ver que coinciden con las obtenidas con la función <code>forecast</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)<span class="sc">*</span>nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">2</span>]) <span class="sc">*</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  nacimientosbEts<span class="sc">$</span>states[TT, <span class="dv">14</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     s12      s11      s10       s9       s8       s7       s6       s5 
27649.64 25216.01 27712.05 26626.41 27976.30 27235.50 28968.53 28643.58 
      s4       s3       s2       s1 
28768.20 29074.70 27505.07 27347.00 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nacimientosbf <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosbEts,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h =</span> <span class="dv">24</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>nacimientosbf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2023       27649.64 26131.95 29167.34
Feb 2023       25216.01 23630.03 26801.99
Mar 2023       27712.05 25750.14 29673.95
Apr 2023       26626.41 24531.86 28720.97
May 2023       27976.30 25554.99 30397.60
Jun 2023       27235.50 24662.31 29808.69
Jul 2023       28968.53 25999.87 31937.19
Aug 2023       28643.58 25476.67 31810.49
Sep 2023       28768.20 25352.21 32184.20
Oct 2023       29074.70 25381.48 32767.93
Nov 2023       27505.07 23780.37 31229.78
Dec 2023       27347.00 23411.02 31282.98
Jan 2024       27434.75 23225.26 31644.25
Feb 2024       25019.90 20963.26 29076.54
Mar 2024       27496.39 22795.51 32197.27
Apr 2024       26419.07 21665.79 31172.35
May 2024       27758.30 22511.93 33004.67
Jun 2024       27023.14 21666.77 32379.50
Jul 2024       28742.51 22776.86 34708.15
Aug 2024       28419.95 22252.12 34587.78
Sep 2024       28543.44 22074.85 35012.04
Oct 2024       28847.40 22029.33 35665.47
Nov 2024       27289.90 20571.02 34008.79
Dec 2024       27132.93 20181.84 34084.01</code></pre>
</div>
</div>
<p>La <a href="#fig-nacimientosMAM">Figura&nbsp;5</a> muestra la serie Nacimientos y las previsiones extramuestrales.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosbf,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientosMAM" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-nacimientosMAM-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;5: Nacimientos y predicción con alisado de Holt-Winters multiplicativo</figcaption>
</figure>
</div>
</div>
</div>
<p><br>
<br>
</p>
</section>
</section>
<section id="ejemplo-con-transformación-logarítmica" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Ejemplo con transformación logarítmica</h1>
<p>Una alternativa para predecir la serie Nacimientos, que tiene esquema multiplicativo, es predecir la transformación logarítmica de la serie, que tendrá un esquema aditivo. Después, se aplica la transformación inversa y se obtienen las predicciones de la serie original.</p>
<p>Este proceso se puede realizar de forma sencilla y transparente con cualquiera de las funciones de que hemos visto a partir de los argumentos <code>lambda</code> y <code>biasadj</code>.</p>
<ul>
<li><code>lambda = 0</code> indica que se ha de realizar la transformación logarítmica de la serie previamente a su modelización. Es un parámetro de la transformación Box-Cox que comentaremos en el tema 6.</li>
<li><code>biasadj = TRUE</code> es necesario si tras una transformación de la serie original queremos que las predicciones sean insesgadas. Sea <span class="math inline">\(y_t\)</span> la serie original y <span class="math inline">\(z_t=log(y_t)\)</span> su transformación logarítmica. Si obtenemos una predicción <span class="math inline">\(\widehat{y}_t\)</span> de la serie original, esta será insesgada <span class="math inline">\(E[\widehat{y}_t]=y_t\)</span>. Ahora bien, si obtenemos una predicción <span class="math inline">\(\widehat{z}_t\)</span> de la serie transformada, podemos pensar que <span class="math inline">\(e^{\widehat{z}_t}\)</span> es una predicción insesgada de la serie original, pero resulta que <span class="math inline">\(E[e^{\widehat{z}_t}] \neq y_t\)</span>. Es decir, la exponencial de la predicción de la serie con transformada logarítmica no es insesgada. Si el argumento <code>biasadj</code> es fijado a FALSE, las predicciones se calcularán de forma directa deshaciendo la transformación y serán sesgadas; si es fijado a TRUE, las predicciones se calcularán por medio de una fórmula alternativa y serán insesgadas. En ambos casos las estimaciones son consistentes, así que para series largas no debería observarse mucha diferencia entre las dos alternativas. Sin entrar en detalles matemáticos, cuanto menor es <em>sigma</em> menor será el sesgo en las predicciones.</li>
</ul>
<p>Vamos a practicar el uso de estos argumentos con la serie Nacimientos. Como se va a predecir el logaritmo de la serie, se debe indicar a la función <code>ets</code> <code>model = "AAA"</code> que estima el modelo Holt-Winters aditivo. Además, vamos a pedir que las predicciones sean insesgadas con <code>biasadj = TRUE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>nacimientosbEtsl <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">model =</span> <span class="st">"AAA"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">damped =</span> <span class="cn">FALSE</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosbEtsl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
 ets(y = nacimientosb, model = "AAA", damped = FALSE, lambda = 0,  

 Call:
     biasadj = TRUE) 

  Box-Cox transformation: lambda= 0 

  Smoothing parameters:
    alpha = 0.4194 
    beta  = 0.0677 
    gamma = 0.1403 

  Initial states:
    l = 10.4564 
    b = 0.0015 
    s = -0.0135 0.0076 0.0343 0.033 0.0198 0.0408
           -0.0297 0.0236 -0.0283 0.0123 -0.0965 -0.0035

  sigma:  0.0297

      AIC      AICc       BIC 
-371.8794 -369.5073 -310.3326 

Training set error measures:
                    ME    RMSE      MAE         MPE     MAPE      MASE
Training set -14.18804 953.356 727.8843 -0.08137768 2.097494 0.5221239
                  ACF1
Training set 0.1264407</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>nacimientosbfl <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosbEtsl,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">h =</span> <span class="dv">24</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">level =</span> <span class="dv">95</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">biasadj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>nacimientosbfl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2023       27537.54 25967.36 29176.87
Feb 2023       25398.85 23791.89 27084.73
Mar 2023       28139.29 26155.46 30232.29
Apr 2023       26852.85 24742.41 29093.59
May 2023       28272.77 25800.76 30915.77
Jun 2023       28014.35 25299.00 30939.52
Jul 2023       30046.70 26832.06 33537.77
Aug 2023       29861.34 26351.23 33705.97
Sep 2023       29826.07 25992.10 34063.26
Oct 2023       30216.58 25988.40 34933.47
Nov 2023       28672.66 24324.23 33571.27
Dec 2023       28164.81 23554.48 33411.28
Jan 2024       28432.04 23348.26 34292.19
Feb 2024       26240.59 21225.47 32083.31
Mar 2024       29091.76 23166.53 36070.78
Apr 2024       27782.11 21769.07 34944.80
May 2024       29273.96 22559.12 37365.74
Jun 2024       29030.36 21991.05 37614.40
Jul 2024       31163.60 23194.50 41000.23
Aug 2024       30999.82 22658.71 41424.34
Sep 2024       30993.08 22237.05 42075.91
Oct 2024       31430.61 22125.95 43361.33
Nov 2024       29856.14 20612.10 41866.62
Dec 2024       29359.59 19869.31 41856.89</code></pre>
</div>
</div>
<p>Observa que en este caso la calidad de las predicciones (MAPE = 2.1%) es algo superior a la obtenida con la serie sin transformar.</p>
<p>La <a href="#fig-nacimientoslog">Figura&nbsp;6</a> muestra la serie Nacimientos y las previsiones extramuestrales obtenidas con y sin la transformación logarítmica.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-nacimientoslog" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-nacimientoslog-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;6: Nacimientos y dos predicciones con alisado de Holt-Winters</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#tbl-nacimientoslog">Tabla&nbsp;2</a> muestra las predicciones de Nacimientos obtenidas sin transformar la serie, con transformación logarítmica y predicciones insesgadas (<code>biasadj = TRUE</code>), y con transformación logarítmica y predicciones sesgadas (<code>biasadj = FALSE</code>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="tbl-nacimientoslog" class="anchored">
<table class="table table-sm table-striped small">
<caption>Tabla&nbsp;2: Diferencias en la predicción según transformación logarítmica y corrección por sesgo</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Sin transformar</th>
<th style="text-align: right;">log(Nac) insesgadas</th>
<th style="text-align: right;">log(Nac) sesgadas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">27649.64</td>
<td style="text-align: right;">27537.54</td>
<td style="text-align: right;">27525.38</td>
</tr>
<tr class="even">
<td style="text-align: right;">25216.01</td>
<td style="text-align: right;">25398.85</td>
<td style="text-align: right;">25384.97</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27712.05</td>
<td style="text-align: right;">28139.29</td>
<td style="text-align: right;">28120.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">26626.41</td>
<td style="text-align: right;">26852.85</td>
<td style="text-align: right;">26829.94</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27976.30</td>
<td style="text-align: right;">28272.77</td>
<td style="text-align: right;">28242.70</td>
</tr>
<tr class="even">
<td style="text-align: right;">27235.50</td>
<td style="text-align: right;">28014.35</td>
<td style="text-align: right;">27977.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">28968.53</td>
<td style="text-align: right;">30046.70</td>
<td style="text-align: right;">29998.12</td>
</tr>
<tr class="even">
<td style="text-align: right;">28643.58</td>
<td style="text-align: right;">29861.34</td>
<td style="text-align: right;">29802.58</td>
</tr>
<tr class="odd">
<td style="text-align: right;">28768.20</td>
<td style="text-align: right;">29826.07</td>
<td style="text-align: right;">29755.26</td>
</tr>
<tr class="even">
<td style="text-align: right;">29074.70</td>
<td style="text-align: right;">30216.58</td>
<td style="text-align: right;">30130.80</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27505.07</td>
<td style="text-align: right;">28672.66</td>
<td style="text-align: right;">28576.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">27347.00</td>
<td style="text-align: right;">28164.81</td>
<td style="text-align: right;">28053.26</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Observa que las predicciones sesgadas son menores que las insesgadas. Esto siempre es así. La diferencia depende fundamentalmente de la desviación típica del error, <em>sigma</em> en la salida de los métodos de alisado exponencial. Cuanto mayor es <em>sigma</em>, mayores son las diferencias.</p>
<p>Por otro lado, las predicciones obtenidas sin y con la transformación logarítmica no guardan ninguna relación.</p>
<p><strong>Ni la transformación logarítmica ni el uso de predicciones insesgadas aseguran mejores predicciones respecto de otras opciones</strong>, como puede ser trabajar con predicciones sesgadas o no realizar la transformación logarítmica.</p>
<p><br>
<br>
</p>
</section>
<section id="casos-generales-de-alisado-exponencial-la-función-ets-de-nuevo" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Casos generales de alisado exponencial: la función <code>ets</code> (de nuevo)</h1>
<p>En los epígrafes previos hemos visto cinco de los casos expuestos en la taxonomía de la <a href="#tbl-taxonomia">Tabla&nbsp;1</a>, fijados a partir de los argumentos <code>model</code> y <code>damped</code> de la función <code>ets</code>. Veamos ahora como estimar cualquiera de los treinta modelos que surgen según las diferentes posibilidades de la tendencia (N, A, Ad, M y Md), la estacionalidad (N, A y M) y el error (A, M).</p>
<p>Recordemos que el tipo de error no influye en el cálculo de las previsiones, solo influye en el cálculo del intervalo de confianza de estas.</p>
<p><strong>Podemos estimar cualquiera de los treinta modelos usando la función <code>ets</code> del paquete <code>forecast</code>.</strong></p>
<p>Lo más habitual es no saber cual es el mejor modelo, entendiendo como tal, el que mejor se ajusta a la serie temporal. De hecho, si lo que buscamos es predecir bien, el mejor modelo será el que mejor prediga.</p>
<p>Si en una de las tres letras del código del modelo se indica “Z”, la función <code>ets</code> selecciona de entre los modelos posibles el que mejor se ajusta. Por ejemplo, <code>model = "AAZ"</code> indica un modelo con error y pendiente aditivos y dejaría a <code>ets</code> la búsqueda de la mejor opción para la estacionalidad (aditiva o multiplicativa). Si se especifica <code>model = "ZZZ</code> junto con <code>damped = NULL</code> (opciones por defecto) se dejaría a la función total libertad para buscar entre todos los modelos (excepto aquellos con pendiente multiplicativa). Si se desea restringir la búsqueda a modelos sin amortiguamiento basta indicar <code>damped = FALSE</code> y si se desea restringir la búsqueda solo a modelos aditivos se puede usar el argumento <code>additive.only = TRUE</code>.</p>
<section id="criterios-de-optimización" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="criterios-de-optimización"><span class="header-section-number">9.1</span> Criterios de optimización</h2>
<p>Fijado un modelo, <code>ets</code> estima por defecto sus parámetros maximizando la función de verosimilitud. Esta búsqueda esta restringida a <span class="math inline">\(0 &lt; \beta &lt; \alpha &lt; 1\)</span>, <span class="math inline">\(0 &lt; \gamma &lt; 1 - \alpha\)</span> y <span class="math inline">\(0.8 &lt; \phi &lt; 0.98\)</span>. Es decir, los tres primeros parámetros nunca pueden ser 0 o 1, y en la práctica sus valores límite son 0.0001 y 0.9999.</p>
<p>Puedes cambiar el criterio de optimización con el argumento <code>opt.crit</code>. Por defecto vale “lik” (de <em>likelihood</em> o verosimilitud), pero si lo fijas a <code>opt.crit = "mse"</code> se estiman los parámetros que minimizan el error cuadrático medio. Otra opción interesante es <code>opt.crit = "amse"</code> que minimiza la media de los errores cuadráticos medios obtenido sobre las previsiones hasta <code>nmse</code> periodos vista. En este caso usa el argumento <code>nmse</code> para fijar el valor numérico del horizonte temporal.</p>
</section>
<section id="criterios-de-selección-de-modelos" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="criterios-de-selección-de-modelos"><span class="header-section-number">9.2</span> Criterios de selección de modelos</h2>
<p>Queda pendiente saber que criterio se usa para seleccionar el modelo cuando se ofrece esta opción. Esto se hace a partir de un criterio de información entre Akaike (aic), Akaike corregido para pequeñas muestras (aicc) y el Bayesiano (bic). Sus fórmulas son: <span class="math display">\[aic = -2log(L) + 2k\]</span> <span class="math display">\[aicc = aic + \frac{k(k+1)}{T-k-1}\]</span> <span class="math display">\[bic=aic + k(log(T) - 2)\]</span> donde <span class="math inline">\(L\)</span> es la verosimilitud, <span class="math inline">\(T\)</span> el número de datos y <span class="math inline">\(k\)</span> el de parámetros estimados (incluidos los puntos iniciales de arranque y la desviación típica del error).</p>
<p><strong>Cuanto menor es el criterio de información, mejor modelo</strong>. Por defecto se usa Akaike corregido para pequeñas muestras (aicc), pero el argumento <code>ic</code> permite cambiar de criterio.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Una reflexión sobre los métodos automáticos de selección de modelos
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Con el comando <code>forecast(ets(nacimientos),h=24)</code> obtenemos una predicción mensual a dos años vista del número de nacimientos en España. Así de simple, solo 31 caracteres. Todo esto gracias a que un algoritmo interno ha estimado los parámetros de múltiples modelos, elegido el mejor modelo de todos y lo ha usado para obtener las predicciones. Podemos afirmar que tenemos las mejores predicciones. Un momento, ¿podemos?</p>
<p>Parémonos a reflexionar sobre lo que hemos hecho o, más bien, lo que el algoritmo ha hecho y a contrastarlo con lo que nosotros queríamos. Por un lado, el algoritmo estima los parámetros de un menú fijo de modelos y para ello usa un criterio de optimización, que por defecto es maximizar la función de verosimilitud; cuando ya tiene estimados todos los modelos, elije el mejor usando el criterio de información de Akaike corregido para muestras pequeñas; y finalmente, nosotros medimos la capacidad predictiva del modelo seleccionado usando el error absoluto porcentual medio. Vaya, resulta que en los procesos de identificación y estimación del mejor modelo se usan dos criterios diferentes, que además no coinciden con nuestro criterio de calidad de las predicciones.</p>
<p>Si consideramos que la calidad de un modelo viene dada por el error absoluto porcentual medio en las predicciones intramuestrales a un periodo vista (lo que hemos decidido llamar MAPE), ¿no deberíamos estimar los parámetros del modelo usando como criterio la minimización del MAPE?, ¿no deberíamos elegir entre varios modelos aquel que presenta un MAPE menor? De esta forma, en todos los pasos del proceso se usa el mismo criterio, que es, además, el criterio que hemos considerado adecuado para valorar la calidad de las predicciones.</p>
<p>Pero no es esto lo que hacemos.</p>
<p>Nada nos garantiza que el modelo estimado y seleccionado por el algoritmo estime las mejores predicciones posibles. Y por <em>mejores</em> quiero decir que de entre todos los posibles modelos del menú y todos los posibles valores de sus parámetros, el seleccionado sea el que minimiza nuestro criterio de calidad de las predicciones.</p>
<p>Ahora ya podemos dar respuesta a la pregunta del primer párrafo: no, no podemos afirmar que nuestras predicciones sean las mejores.</p>
<p>Alguien dirá que casi seguro entre las predicciones subóptimas obtenidas por el algoritmo con su extraña mezcla de criterios y las predicciones óptimas de verdad no habrá mucha diferencia. Total, que más da una función de verosimilitud que un criterio de información que una medida del error medio. Pero lo cierto es que no lo sabemos, no tenemos ni idea de la distancia que hay entre lo óptimo y lo sub-óptimo, y si el coste de equivocarme en las predicciones es alto, puede que incluso una pequeña diferencia sea relevante.</p>
<p>Esta reflexión realizada en el contexto de series temporales y para la función <code>ets</code> es aplicable a todos los casos donde dejamos que un algoritmo ya programado elija el mejor modelo, y se basa en el hecho de que rara vez los criterios de estimación y elección que usan los algoritmos coinciden con el concepto de calidad de ajuste que estamos interesados.</p>
<p>A pesar de lo aquí expuesto, como es más cómodo (y rápido) tirar de rutinas ya programadas que escribir nuestro propio código, seguiremos trabajando con modelos subóptimos y obteniendo estimaciones subóptimas, pero diciendo que son las mejores.</p>
</div>
</div>
</div>
<p><br>
</p>
</section>
</section>
<section id="residuo-de-un-modelo" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Residuo de un modelo</h1>
<p>Todo modelo estimado con una función de <code>R</code> tiene asociado un residuo que podemos <em>extraer</em> con la función <code>residuals</code>. En los modelos más sencillos este error se define de la forma usual, <span class="math inline">\(\widehat{\varepsilon}_t = y_t - \widehat{y}_t\)</span>, pero no siempre es así. Veamos algunas excepciones y como proceder.</p>
<p><br>
</p>
<p><strong>Residuo aditivo versus residuo multiplicativo</strong></p>
<p>En los modelos de alisado estimados por la función <code>ets</code> la fórmula para el cálculo del residuo estimado depende de su naturaleza aditiva o multiplicativa.</p>
<p>Si el <strong>residuo es aditivo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t + \widehat{\varepsilon}_t\)</span> y el residuo se define de la forma usual <span class="math display">\[\widehat{\varepsilon}_t = y_t - \widehat{y}_t.\]</span></p>
<p>Ahora bien, si el <strong>residuo es multiplicativo</strong>, entonces el modelo es <span class="math inline">\(y_t = \widehat{y}_t \cdot (1 + \widehat{\varepsilon}_t)\)</span>, y no <span class="math inline">\(y_t = \widehat{y}_t \cdot \widehat{\varepsilon}_t\)</span> como se podría esperar. Por tanto, el residuo multiplicativo se define como <span class="math display">\[\widehat{\varepsilon}_t = (y_t - \widehat{y}_t)/\widehat{y}_t.\]</span></p>
<p>De esta forma en ambos casos –aditivo y multiplicativo– el residuo evoluciona alrededor del valor 0 y se le pueden imponer las hipótesis usuales de ruido blanco. Observa que el error multiplicativo tampoco es el error porcentual tal y como se define para el calculo del MPE o del MAPE.</p>
<p>Si hemos estimado con la función <code>ets</code> un modelo con residuo multiplicativo y extraemos el residuo con la función <code>residuals</code> se usará la fórmula previamente indicada. Si se desea obtener el residuo aditivo, se debe usar la función <code>residuals</code> con el argumento <code>type = "response"</code>.</p>
<p><strong>Residuo de un modelo logarítmico</strong></p>
<p>Si tenemos una serie <span class="math inline">\(y_t\)</span>, pero el modelo se ha obtenido sobre su transformación logarítmica <span class="math inline">\(z_t = \log(y_t)\)</span>, el residuo (que siempre será aditivo) que obtendremos por defecto es <span class="math display">\[\widehat{\varepsilon}_t = z_t - \widehat{z}_t.\]</span></p>
<p>Si se desea obtener el error sobre la serie original, es decir <span class="math inline">\(\widehat{\varepsilon}_t = y_t - \widehat{y}_t\)</span>, de nuevo hay que usar la función <code>residuals</code> con el argumento <code>type = "response"</code>.</p>
<p><br>
<br>
</p>
</section>
<section id="ejemplos-de-aplicación" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Ejemplos de aplicación</h1>
<p><br>
</p>
<section id="libros" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="libros"><span class="header-section-number">11.1</span> Libros</h2>
<section id="identificación-y-estimación-del-mejor-modelo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo">Identificación y estimación del mejor modelo</h3>
<p>Si estimamos el mejor modelo de alisado exponencial para la serie Libros sin ningún tipo de restricción, nos encontramos:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>librosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(libros)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(librosEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(M,N,N) 

Call:
 ets(y = libros) 

  Smoothing parameters:
    alpha = 0.9999 

  Initial states:
    l = 40459.0122 

  sigma:  0.0902

     AIC     AICc      BIC 
557.0738 558.1173 560.9613 

Training set error measures:
                   ME     RMSE      MAE      MPE     MAPE      MASE        ACF1
Training set 877.6729 5798.394 4367.896 1.318359 6.900756 0.9654123 -0.03788908</code></pre>
</div>
</div>
<p>El modelo estimado es ETS(M,N,N) o “MNN”, un modelo sin pendiente ni estacionalidad y con error multiplicativo. Es decir, <span class="math inline">\(y_{t+1} = l_t \cdot (1 + \varepsilon_{t+1})\)</span>.</p>
<p>El valor de <span class="math inline">\(\alpha\)</span> técnicamente es 1, indicando que el nivel de la serie varia en el tiempo y que realmente estamos usando para las previsiones el método ingenuo I.</p>
<p>Respecto de la calidad del modelo, el valor de MAPE= <span class="math inline">\(6.9\)</span>% evidencia que estamos ante un modelo que se ajusta moderadamente bien a los datos. MASE= <span class="math inline">\(0.97\)</span> indica que el modelo de alisado exponencial simple reduce en solo un <span class="math inline">\(3\)</span>% el error del método ingenuo I. Además, el modelo estimado presenta un marcado sesgo positivo, las predicciones en promedio son menores que los valores reales.</p>
</section>
<section id="predicción" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción">Predicción</h3>
<p>Mediante la función <code>forecast</code> podemos predecir los casos de Libros. Por tratarse de un modelo sin pendiente ni estacionalidad, la predicción es constante en el tiempo (véase <a href="#fig-librosETSLibre">Figura&nbsp;7</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>librosEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(librosEts, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">5</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>librosEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Point Forecast    Lo 95    Hi 95
2020        64153.8 52808.97 75498.64
2021        64153.8 48077.97 80229.63
2022        64153.8 44425.26 83882.34
2023        64153.8 41327.01 86980.59
2024        64153.8 38580.71 89726.89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(librosEtsPre,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Títulos"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-librosETSLibre" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-librosETSLibre-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;7: Libros y predicción a 5 años vista</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-residuo" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-residuo">Análisis del residuo</h3>
<p>El error de un modelo de alisado <em>contiene</em> la componente de <strong>Intervención</strong> y el propio término de <strong>Error</strong>. Ver numérica o gráficamente el error permite identificar fácilmente la presencia de valores atípicos (intervención). Obtenemos el error con la función <code>residuals</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(librosEts)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">1993</span>, <span class="dv">2019</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-librosError" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-librosError-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;8: Error + Intervención</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-librosError">Figura&nbsp;8</a> muestra que aunque algún error supera las dos desviaciones típicas, ninguno puede ser considerado claramente como atípico.</p>
</section>
<section id="validación-error-extramuestral-a-varios-periodos-vista" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-error-extramuestral-a-varios-periodos-vista">Validación: error extramuestral a varios periodos vista</h3>
<p>Vamos a mejorar la estimación de la calidad de las predicciones obteniendo el MAPE para <strong>previsiones extramuestrales a varios periodos vista</strong>. Para ello vamos a reservar, por ejemplo, las últimas 6 observaciones de la serie Libros y ajustar el modelo con las restantes. Después usaremos este modelo para calcular las predicciones a 6 periodos vista y compararlas con los valores reales de la serie Libros.</p>
<p>Recuerda, este método para valorar la calidad de las predicciones usa la filosofía del método <em>training set/test set</em>: el periodo de datos usado en la estimación no se usa como periodo de datos para la validación. Sin embargo, tiene el problema de que el error obtenido es una mezcla de errores de predicción a corto, medio y largo plazo difícil de valorar. Además, los resultados dependen tremendamente del punto de corte temporal seleccionado.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definimos las observaciones intra y extramuestrales</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>librosIntra <span class="ot">&lt;-</span> <span class="fu">subset</span>(libros, <span class="at">end =</span> <span class="fu">length</span>(libros) <span class="sc">-</span> <span class="dv">6</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>librosExtra <span class="ot">&lt;-</span> <span class="fu">subset</span>(libros, <span class="at">start =</span> <span class="fu">length</span>(libros) <span class="sc">-</span> <span class="dv">5</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimamos el modelo con todos los datos menos los 6 ultimos</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>librosIntraEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(librosIntra, <span class="at">model =</span> <span class="st">"MNN"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Predecimos los 6 años que hemos quitado de la serie y </span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># vemos la calidad del ajuste.</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>librosExtraPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(librosIntraEts, <span class="at">h =</span> <span class="dv">6</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(librosExtraPre, librosExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    ME     RMSE      MAE      MPE     MAPE      MASE
Training set  764.4434 6445.919 5075.985 1.116656 7.994644 0.9557225
Test set     4084.3395 4786.634 4219.782 6.586626 6.828358 0.7945138
                    ACF1 Theil's U
Training set -0.04292193        NA
Test set      0.08397051  1.881683</code></pre>
</div>
</div>
<p>Atendiendo al MAPE se tiene que el error de <strong>previsión a un periodo vista</strong> en el <strong>periodo intramuestral</strong> de <strong>1993 a 2013</strong> es del 8%; y el error de <strong>previsión a largo plazo</strong> en el <strong>periodo extramuestral</strong> de <strong>2014 a 2019</strong> es del 6.8%. Sin embargo, para el periodo extramuestral el error medio (ME) es muy elevado, un indicativo de que las previsiones están segadas. Para el punto de corte elegido, la calidad de las previsiones no se deteriora cuanto nos salimos de las condiciones óptimas.</p>
<p>Un gráfico puede ayudar a entender este proceso de validación. En la <a href="#fig-librosTSTS">Figura&nbsp;9</a>:</p>
<ul>
<li>La línea de puntos vertical separa el periodo muestral (1993-2013) usado para estimar el modelo, del periodo extramuestral (2014-2019) usado sólo para hacer las previsiones.</li>
<li>La serie Libros aparece como una línea sólida en negro, desde 1993 hasta 2019.</li>
<li>La previsión <em>intra</em>-muestral (a un periodo vista) de la serie Libros aparece como una línea azul. Observa la previsión puede ser mayor o menor que la serie, no evidenciándose sesgo.</li>
<li>La línea en rojo es la previsión <em>extra</em>-muestral a largo plazo: <span class="math inline">\(\hat{y}_{T+h}=l_T\)</span>, donde <span class="math inline">\(T=2013\)</span>. Observa que todas las previsiones están por debajo del valor real de la serie: la previsión extramuestral está sesgada.</li>
<li>Al lado de cada previsión se ha indicado el error estimado (MAPE). Para la previsión extramuestral, el error es la media de errores muy bajos (primeras previsiones) y errores muy elevados (últimas previsiones).</li>
</ul>
<p>Claramente estos resultados dependen del punto de corte seleccionado.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-librosTSTS" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-librosTSTS-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;9: Libros, predicción intra y extramuestral</figcaption>
</figure>
</div>
</div>
</div>
<p>La presencia de tendencia, primero creciente y luego decreciente, en la serie Libros puede hacernos pensar que un modelo más adecuado para su ajuste y predicción sería ETS(M,A,N), forzando a que haya pendiente. De hecho, el error de estimación de este modelo es del 6.1%, frente al 6.9% para el modelo ETS(M,N,N). Sin embargo, el error de previsión extramuestral a largo plazo para el modelo ETS(M,A,N) es del 12.1%, frente al 6.8% para el modelo ETS(M,N,N). <strong>Mejor ajuste no implica mejor predicción.</strong> De nuevo, incidir en que claramente estos resultados dependen del punto de corte seleccionado.</p>
<p><br>
</p>
</section>
</section>
<section id="nacimientos" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="nacimientos"><span class="header-section-number">11.2</span> Nacimientos</h2>
<p>Veamos un segundo ejemplo con la serie Nacimientos (desde el año 2000).</p>
<section id="identificación-y-estimación-del-mejor-modelo-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo-1">Identificación y estimación del mejor modelo</h3>
<p>Si damos total libertad al proceso de selección del mejor modelo, el modelo estimado es ETS(A,A,A), es decir, <span class="math inline">\(y_{t+1} = l_t + b_t + s_{t+1-m} + \varepsilon_{t+1}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>nacimientosEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(nacimientosb, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nacimientosEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,A,A) 

Call:
 ets(y = nacimientosb, damped = FALSE) 

  Smoothing parameters:
    alpha = 0.4933 
    beta  = 0.0108 
    gamma = 0.0001 

  Initial states:
    l = 33050.1612 
    b = 144.1429 
    s = -25.3765 -47.6828 2011.89 1490.777 974.0097 1251.884
           -975.9382 256.4606 -1342.336 -158.8668 -3355.703 -79.1191

  sigma:  916.531

     AIC     AICc      BIC 
5333.717 5336.089 5395.264 

Training set error measures:
                    ME     RMSE      MAE       MPE     MAPE      MASE
Training set -69.50818 889.5682 675.4783 -0.221582 1.957404 0.4845322
                   ACF1
Training set 0.06139082</code></pre>
</div>
</div>
<p>El bajo valor de <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\gamma\)</span> indican que ambas, la pendiente y la estacionalidad, varían muy lentamente en el tiempo (véase la <a href="#fig-nacimientoscomponentes">Figura&nbsp;10</a>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosEts,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientoscomponentes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-nacimientoscomponentes-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;10: Componentes del modelo óptimo para Nacimientos</figcaption>
</figure>
</div>
</div>
</div>
<p>Respecto de la calidad del modelo, el MAPE de 2% indica que estamos ante un modelo que se ajusta muy bien a los datos; y el valor de MASE igual a 0.48 indica que este modelo reduce en un 52% el error del método ingenuo con estacionalidad, el más sencillo posible.</p>
<p>Podemos ver los últimos valores estimados del nivel, la pendiente y la estacionalidad para interpretarlos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(nacimientosEts<span class="sc">$</span>states)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>nacimientosEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          l           b          s1          s2          s3          s4 
27519.26626   -63.61016   -25.53601   -47.67198  2011.60284  1490.50180 
         s5          s6          s7          s8          s9         s10 
  973.93433  1251.73023  -976.16193   256.24927 -1342.52402  -159.02341 
        s11         s12 
-3355.79580   -79.22413 </code></pre>
</div>
</div>
<p>Febrero es el mes con menor número de nacimientos: nacen 3355 bebés menos, respecto de la media anual. En octubre es cuando más bebés nacen: 2011 más que la media anual.</p>
<p>Podemos usar estos valores para predecir un año,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">*</span> nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">2</span>] <span class="sc">+</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  nacimientosEts<span class="sc">$</span>states[TT, <span class="dv">14</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     s12      s11      s10       s9       s8       s7       s6       s5 
27376.43 24036.25 27169.41 25922.30 27457.46 26161.44 28325.73 27984.32 
      s4       s3       s2       s1 
28437.28 28894.77 26771.88 26730.41 </code></pre>
</div>
</div>
<p>Nuestra predicción para enero de 2020 es de 27376 bebés y para diciembre de 2020 de 26730 bebés.</p>
</section>
<section id="predicción-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-1">Predicción</h3>
<p>Si pedimos los valores de predicción tenemos (sólo se muestran los primeros meses):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>nacimientosEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(nacimientosEts, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">h =</span> <span class="dv">24</span>, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>nacimientosEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
Jan 2023       27376.43 25580.06 29172.80
Feb 2023       24036.25 22024.56 26047.94
Mar 2023       27169.41 24955.26 29383.56
Apr 2023       25922.30 23515.15 28329.46
May 2023       27457.46 24864.50 30050.43</code></pre>
</div>
</div>
<p>La <a href="#fig-nacimientosPrediccion">Figura&nbsp;11</a> muestra la serie Nacimientos, su predicción a dos años vista y el intervalo de confianza.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nacimientosEtsPre,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Nacimientos"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-nacimientosPrediccion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-nacimientosPrediccion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;11: Nacimientos y predicción</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-error" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-error">Análisis del error</h3>
<p>Se identifica varios valores claramente atípicos –superan las 4 desviaciones típicas– que corresponden a enero de 2011 y, aproximadamente, nueves después del confinamiento por la pandemia (diciembre de 2020, y febrero y marzo de 2021). Abril de 2008 y diciembre de 2010 son otros candidatos a intervención por superar las 2.5 desviaciones típicas.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(nacimientosEts)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Periodo"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2019</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacimientosError" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-NacimientosError-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;12: Error + Intervención</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="validación-error-extramuestral-según-horizonte-temporal" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="validación-error-extramuestral-según-horizonte-temporal">Validación: error extramuestral según horizonte temporal</h3>
<p>En este ejemplo calcularemos el error extramuestral según el horizonte temporal de previsión, una metodología que ya hemos visto anteriormente.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">120</span>                 </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">12</span>                  </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">length</span>(nacimientosb)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> TT <span class="sc">-</span> k <span class="sc">-</span> h </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>mapeAlisado <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, s <span class="sc">+</span> <span class="dv">1</span>, h)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>s) {</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  train.set <span class="ot">&lt;-</span> <span class="fu">subset</span>(nacimientosb, <span class="at">start =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  test.set <span class="ot">&lt;-</span>  <span class="fu">subset</span>(nacimientosb, <span class="at">start =</span> i <span class="sc">+</span> k <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> i <span class="sc">+</span> k <span class="sc">+</span> h)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">ets</span>(train.set, <span class="at">model =</span> <span class="st">"MAA"</span>, <span class="at">damped =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  fcast<span class="ot">&lt;-</span><span class="fu">forecast</span>(fit, <span class="at">h =</span> h)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  mapeAlisado[i <span class="sc">+</span> <span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">abs</span>(test.set <span class="sc">-</span> fcast<span class="sc">$</span>mean)<span class="sc">/</span>test.set</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>errorAlisado <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(mapeAlisado)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>errorAlisado</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2.222763 2.546718 2.695250 3.024869 2.988470 3.023482 3.225675 3.221769
 [9] 3.310989 3.499843 3.442572 3.645526</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">y =</span> errorAlisado)) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Horizonte temporal de predicción"</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"MAPE"</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-NacimientosErrorRW" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-NacimientosErrorRW-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;13: Error de predicción según horizonte temporal</figcaption>
</figure>
</div>
</div>
</div>
<p>La <a href="#fig-NacimientosErrorRW">Figura&nbsp;13</a> muestra el error de previsión extramuestral según el horizonte temporal. El error extramuestral a un periodo vista es comparable al error intramuestral (2.2% frente a 2.0%). Aunque el error de previsión aumenta conforme lo hace el horizonte temporal, siempre se mantiene muy bajo. Por ejemplo, en las previsiones a 12 meses vista el error es del 3.6%.</p>
</section>
</section>
<section id="demanda-eléctrica" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="demanda-eléctrica"><span class="header-section-number">11.3</span> Demanda eléctrica</h2>
<p>Consideraremos la serie de Demanda eléctrica desde el 31 de enero hasta el 29 de mayo, 17 semanas completas de 2022.</p>
<section id="identificación-y-estimación-del-mejor-modelo-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="identificación-y-estimación-del-mejor-modelo-2">Identificación y estimación del mejor modelo</h3>
<p>El modelo óptimo (ANA) no presenta tendencia y tiene error y estacionalidad aditiva, es decir, <span class="math inline">\(y_{t+1} = l_t + s_{t+1-m} + \varepsilon_{t+1}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>electricidadEts <span class="ot">&lt;-</span> <span class="fu">ets</span>(electricidad)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(electricidadEts) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ETS(A,N,A) 

Call:
 ets(y = electricidad) 

  Smoothing parameters:
    alpha = 0.9995 
    gamma = 0.0003 

  Initial states:
    l = 733.1601 
    s = -91.5867 -44.288 22.3851 31.0969 38.0069 33.3497
           11.0362

  sigma:  19.2269

     AIC     AICc      BIC 
1282.960 1284.997 1310.751 

Training set error measures:
                    ME     RMSE      MAE        MPE     MAPE      MASE
Training set -0.521831 18.48558 12.05976 -0.1171496 1.840559 0.4758963
                   ACF1
Training set 0.04606669</code></pre>
</div>
</div>
<p>El valor <span class="math inline">\(\gamma = 0\)</span> indica que las estacionalidad se mantiene contante en el tiempo, mientras que el elevado valor de <span class="math inline">\(\alpha\)</span> indica que el nivel de la serie cambia de forma constante.</p>
<p>Respecto de la calidad del modelo, el MAPE de 1.8% indica que estamos ante un modelo que se ajusta muy bien a los datos; no hay sesgo (ME es casi cero); y el valor de ACF1, muy bajo, indica que la fórmula usada para el cálculo del intervalo de confianza de las predicciones es válida.</p>
<p>Podemos ver los últimos valores estimados del nivel y la estacionalidad para interpretarlos.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>TT <span class="ot">&lt;-</span> <span class="fu">nrow</span>(electricidadEts<span class="sc">$</span>states)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        l        s1        s2        s3        s4        s5        s6        s7 
671.09030 -91.59002 -44.29457  22.38701  31.10112  37.99754  33.34777  11.03184 </code></pre>
</div>
</div>
<p>El domingo la demanda eléctrica cae 91 GWh respecto de la media semanal. Por el contrario, el martes y el miércoles son los días de mayor demanda respecto de la media semanal: 33 GWh y 37 GWh respectivamente.</p>
<p>También podemos usarlos para predecir una semana,</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>electricidadEts<span class="sc">$</span>states[TT, <span class="dv">1</span>] <span class="sc">+</span> electricidadEts<span class="sc">$</span>states[TT, <span class="dv">8</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      s7       s6       s5       s4       s3       s2       s1 
682.1221 704.4381 709.0878 702.1914 693.4773 626.7957 579.5003 </code></pre>
</div>
</div>
</section>
<section id="predicción-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="predicción-2">Predicción</h3>
<p>Si pedimos los valores de predicción para las cuatro semanas siguientes, tenemos (sólo se muestran las dos primeras):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>electricidadEtsPre <span class="ot">&lt;-</span> <span class="fu">forecast</span>(electricidadEts, </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">h =</span> <span class="dv">28</span>, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">level =</span> <span class="dv">95</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>electricidadEtsPre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>         Point Forecast    Lo 95    Hi 95
23.00000       682.1221 644.4380 719.8062
23.14286       704.4381 651.1568 757.7194
23.28571       709.0878 643.8368 774.3389
23.42857       702.1914 626.8488 777.5340
23.57143       693.4773 609.2436 777.7110
23.71429       626.7957 534.5237 719.0677
23.85714       579.5003 479.8318 679.1688
24.00000       682.1221 575.5735 788.6708
24.14286       704.4381 591.4273 817.4488
24.28571       709.0878 589.9651 828.2106
24.42857       702.1914 577.2553 827.1276
24.57143       693.4773 562.9865 823.9681
24.71429       626.7957 490.9773 762.6142
24.85714       579.5003 438.5523 720.4483</code></pre>
</div>
</div>
<p>La <a href="#fig-electricidadPrediccion">Figura&nbsp;14</a> muestra la serie Demanda eléctrica, su predicción a cuatro semanas vista y el intervalo de confianza.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(electricidadEtsPre,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"GWh"</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadPrediccion" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-electricidadPrediccion-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;14: Demanda eléctrica y predicción</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análisis-del-error-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="análisis-del-error-1">Análisis del error</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">residuals</span>(electricidadEts)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sderror <span class="ot">&lt;-</span> <span class="fu">sd</span>(error)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(error, <span class="at">series=</span><span class="st">"Error"</span>,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">colour =</span> <span class="st">"black"</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">"Semana"</span>,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">"Error"</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span> ,<span class="dv">3</span>)<span class="sc">*</span>sderror, </span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span> <span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">26</span>, <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-electricidadError" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="03-05-Tema5_files/figure-html/fig-electricidadError-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption class="figure-caption">Figura&nbsp;15: Error + Intervención</figcaption>
</figure>
</div>
</div>
</div>
<p>El la <a href="#fig-electricidadError">Figura&nbsp;15</a> se identifican en la semana 16 varios días atípicos –supera las 4 desviaciones típicas– que corresponden a la Semana Santa, que en 2022 fue del 10 de abril al 17 de abril. Los dos valores mas extremos corresponden al Jueves Santo, que por ser vacacional tuvo un consumo de electricidad inferior al esperado; y el sábado siguiente donde el consumo fue superior al esperado.</p>
<p><br>
<br>
</p>
</section>
</section>
</section>
<section id="otras-alternativas-para-ajustar-un-modelo-y-predecir" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Otras alternativas para ajustar un modelo y predecir</h1>
<p>A la hora de ajustar un modelo a una serie y predecir hay que ser un poco imaginativos, dedicarle tiempo y probar cosas. Por ejemplo, podríamos considerar la transformación logarítmica de la serie. O podríamos cambiar el criterio de estimación de los parámetros o el de selección del modelo óptimo.</p>
<p>Yendo un poco más lejos, para una serie mensual (como Nacimientos) dado que el valor de la serie dependerá forzosamente del número de días del mes, podríamos ajustar y predecir el valor medio de la serie por día del mes. Por ejemplo, los nacimientos medios por día: cociente entre los nacimientos de cada mes y el número de días del mes. Esta serie tendrá una componente estacional más suave, al eliminar el efecto de los meses de febrero bisiestos, y tendrá, previsiblemente, un mejor ajuste.</p>
<p>También podemos mezclar varios de los enfoques previos o ser aún más imaginativos.</p>
<p>El siguiente código muestra el MAPE (para previsiones intramuestrales a un periodo vista) para la serie Nacimientos usando varias de estas opciones. Puedes deducir que se está haciendo en cada caso a partir del código. Sería más adecuado usar otro criterio de validación diferente, pero el objetivo de este epígrafe es recalcar que no hay que quedarse con lo inmediato (predecir una serie con las opciones por defecto de las funciones), sino probar y probar.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Serie Nacimientos</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.957404</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.957395</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"amse"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.983517</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformación logarítmica</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.929991</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.929991</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"amse"</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.079451</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformación logarítmica insesgada</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">biasadj =</span> <span class="cn">TRUE</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.933898</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">biasadj =</span> <span class="cn">TRUE</span>,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.933898</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb, </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">biasadj =</span> <span class="cn">TRUE</span>,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"amse"</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.081935</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nacimientos por dia</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb<span class="sc">/</span><span class="fu">monthdays</span>(nacimientosb)))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.861714</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb<span class="sc">/</span><span class="fu">monthdays</span>(nacimientosb), </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"mse"</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.861714</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">ets</span>(nacimientosb<span class="sc">/</span><span class="fu">monthdays</span>(nacimientosb), </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">opt.crit =</span> <span class="st">"amse"</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">nmse =</span> <span class="dv">4</span>))[<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.919763</code></pre>
</div>
</div>
<p>La principal conclusión en este caso es que salirse de la estimación directa sobre la serie original no reduce el error significativamente. Sin embargo, cabe destacar que,</p>
<ul>
<li>El error de estimación de los nacimientos por día es menor que el error obtenido con la serie original de nacimiento. Véanse los tres últimos modelos respecto de los tres primeros.</li>
<li>Usar la transformación logarítmica (con o sin predicciones insesgadas) puede mejorar o no la capacidad predictiva del modelo, dependiendo del resto de parámetros. Véanse los modelos 4 a 9 respecto de los modelos 1 a 3.</li>
<li>El mejor modelo estima los nacimientos por día y estima los parámetros minimizando la verosimilitud o el error cuadrático medio (“mse”). No siempre el uso directo de la serie ofrece los mejores resultados.</li>
</ul>
<p><br>
<br>
</p>
</section>
<section id="resumen-de-los-comandos-utilizados" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Resumen de los comandos utilizados</h1>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Función</th>
<th style="text-align: left;">Paquete</th>
<th style="text-align: left;">Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ets</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Estimación de una amplia familia de métodos de alisado exponencial</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>forecast</code></td>
<td style="text-align: left;">forecast</td>
<td style="text-align: left;">Obtiene la predicción de una serie a partir de un modelo estimado</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>residuals</code></td>
<td style="text-align: left;">stats</td>
<td style="text-align: left;">Obtiene el residuo de un modelo estimado</td>
</tr>
</tbody>
</table>
<p><br>
<br>
<br>
<br>
</p>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Brown59" class="csl-entry" role="listitem">
Brown, Robert Goodell. 1959. <em>Statistical Forecasting for Inventory Control</em>. McGraw-Hill, New York.
</div>
<div id="ref-Gardner85" class="csl-entry" role="listitem">
Gardner, Everette S., and Ed. Mckenzie. 1985. <span>“Forecasting Trends in Time Series.”</span> <em>Management Science</em> 31 (10): 1237–46. <a href="https://doi.org/10.1287/mnsc.31.10.1237">https://doi.org/10.1287/mnsc.31.10.1237</a>.
</div>
<div id="ref-Holt" class="csl-entry" role="listitem">
Holt, Charles C. 2004. <span>“Forecasting Seasonals and Trends by Exponentially Weighted Moving Averages.”</span> <em>International Journal of Forecasting</em> 20 (1): 5–10. https://doi.org/<a href="https://doi.org/10.1016/j.ijforecast.2003.09.015">https://doi.org/10.1016/j.ijforecast.2003.09.015</a>.
</div>
<div id="ref-Hyndman08" class="csl-entry" role="listitem">
Hyndman, Rob J., and Y. Khandakar. 2008. <span>“Automatic Time Series Forecasting: The Forecast Package for r.”</span> <em>Journal of Statistical Software</em> 27 (3): 1–22. <a href="https://doi.org/10.18637/jss.v027.i03">https://doi.org/10.18637/jss.v027.i03</a>.
</div>
<div id="ref-Hyndman08b" class="csl-entry" role="listitem">
Hyndman, Rob J., A. Koehler, K. Ord, and R. Snyder. 2008. <em>Forecasting with Exponential Smoothings. The State Space Approach</em>. Springer Berlin, Heidelberg. <a href="https://doi.org/10.1007/978-3-540-71918-2">https://doi.org/10.1007/978-3-540-71918-2</a>.
</div>
<div id="ref-Winters60" class="csl-entry" role="listitem">
Winters, Peter R. 1960. <span>“Forecasting Sales by Exponentially Weighted Moving Averages.”</span> <em>Management Science</em> 6 (3): 324–42. <a href="https://doi.org/10.1287/mnsc.6.3.324">https://doi.org/10.1287/mnsc.6.3.324</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Formalmente en el modelo de Holt-Winters multiplicativo el error es aditivo. Es decir, debería ser <code>model = "AAM"</code>. Este modelo se puede estimar mediante la función <code>hw</code> que replica fielmente el modelo definido en su momento por Holt y Winters. Sin embargo, al usar la función <code>ets</code>, que posibilita el cálculo de intervalos de confianza para las predicciones, no es factible estimar un modelo con estacionalidad multiplicativa y error aditivo. Por este motivo se fija <code>model = "MAM"</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Una forma sencilla de identificar donde están los valores atípicos es mediante el comando <code>abs(error) &gt; 3 * sderror</code> que devuelve una tabla de FALSE y TRUE, donde TRUE identifica las fechas con errores que superan las 3 desviaciones típicas. El comando <code>time(error)[abs(error) &gt; 3 * sderror]</code> devuelve solo las fechas asociadas a errores atípicos. El valor de 3 es uno de los posibles y debe ajustarse a las características de la serie y el análisis.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© Copyright 2023, Iván Arribas. If you find any bugs please report them to <a href="mailto:ivan.arribas@uv.es">ivan.arribas@uv.es</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a></div>
  </div>
</footer>



</body></html>